{"version":3,"file":"jquire.min.js","sources":["utility.js","jquire.js"],"sourcesContent":["const CREATED = Symbol(\"created\")\r\nconst UPDATED = Symbol(\"updated\")\r\nconst DELETED = Symbol(\"deleted\")\r\nconst UNCHANGED = Symbol(\"unchanged\")\r\n\r\nexport const OnAttachCallback = Symbol(\"OnAttachCallback\")\r\nexport const OnDetachCallback = Symbol(\"OnDetachCallback\")\r\n\r\nexport const StateReference = Symbol(\"StateReference\")\r\n\r\nexport const PromisePending = Symbol(\"PromisePending\")\r\nexport const PromiseResolved = Symbol(\"PromiseResolved\")\r\nexport const PromiseRejected = Symbol(\"PromiseRejected\")\r\n\r\n/**\r\n * @type {{[x: string | symbol | number]: string}}\r\n */\r\nexport const paths = Object.create(null)\r\n\r\n/**\r\n * @param {unknown} test\r\n */\r\nexport const isPrimitive = (test) => test !== Object(test)\r\n\r\n/**\r\n * @param  {any[]} xs\r\n */\r\nexport const isJqElement = (...xs) => xs.every(x => x instanceof JqElement)\r\n\r\n/**\r\n * @param  {any[]} xs\r\n */\r\nexport const isJqAttribute = (...xs) => xs.every(x => x instanceof JqAttribute)\r\n\r\n/**\r\n * @param  {any[]} xs\r\n */\r\nexport const isJqFragment = (...xs) => xs.every(x => x instanceof JqFragment)\r\n\r\n/**\r\n * @param  {any[]} xs\r\n */\r\nexport const isJqText = (...xs) => xs.every(x => x instanceof JqText)\r\n\r\n/**\r\n * @param  {unknown[]} values\r\n */\r\nexport function isNullish(...values) {\r\n\treturn values.every(x => x === null || x === undefined)\r\n}\r\n\r\nconst createHash = (length = 5) => Math.random().toString(32).replace(/\\d\\./, '').slice(0, length)\r\n\r\nconst getJqNodeConstructors = () => [\r\n\tJqElement, JqAttribute, JqCSSProperty,\r\n\tJqCSSRule, JqAnimation, JqEvent,\r\n\tJqWatch, JqFragment, JqText,\r\n\tJqEach, JqEvent, JqCondition,\r\n\tJqLifecycle, JqList, JqPromise\r\n]\r\n\r\n/**\r\n * @param {string} e \r\n */\r\nexport const throwError = (e, errorClass = Error) => { throw new errorClass(e) }\r\nexport const JqNodeReference = Symbol(\"JqNodeReference\")\r\n\r\n/**\r\n * \r\n * @param {Array<JqNode | Primitive>} nodes \r\n * @returns {{\r\n *\t\tchildNodes: Array<JqElement | JqFragment | JqText>,\r\n *\t\tattributes: JqAttribute[],\r\n *\t\tevents: JqEvent[], animations: JqAnimation[], \r\n *\t\tinlineStyles: JqCSSProperty[],\r\n *\t\tblockStyles: JqCSSRule[], watchers: JqWatch[],\r\n *\t\tconditions: JqCondition[], iterators: JqEach<any>[],\r\n *\t\tlifecycles: JqLifecycle[], promiseStates: JqPromiseState<any>[]\r\n * }}\r\n */\r\nexport function getNodes(nodes) {\r\n\t/**\r\n\t * @type {Array<JqElement | JqFragment | JqText>}\r\n\t */\r\n\tconst childNodes = []\r\n\r\n\t/**\r\n\t * @type {JqAttribute[]}\r\n\t */\r\n\tconst attributes = []\r\n\r\n\t/**\r\n\t * @type {JqEvent[]}\r\n\t */\r\n\tconst events = []\r\n\r\n\t/**\r\n\t * @type {JqAnimation[]}\r\n\t */\r\n\tconst animations = []\r\n\r\n\t/**\r\n\t * @type {JqWatch[]}\r\n\t */\r\n\tconst watchers = []\r\n\r\n\t/**\r\n\t * @type {JqCondition[]}\r\n\t */\r\n\tconst conditions = []\r\n\r\n\t/**\r\n\t * @type {JqEach<any>[]}\r\n\t */\r\n\tconst iterators = []\r\n\r\n\t/**\r\n\t * @type {JqLifecycle[]}\r\n\t */\r\n\tconst lifecycles = []\r\n\r\n\t/**\r\n\t * @type {JqPromiseState<any>[]}\r\n\t */\r\n\tconst promiseStates = []\r\n\r\n\t/**\r\n\t * @type {JqCSSProperty[]}\r\n\t */\r\n\tconst inlineStyles = []\r\n\r\n\t/**\r\n\t * @type {JqCSSRule[]}\r\n\t */\r\n\tconst blockStyles = []\r\n\r\n\tlet i = 0\r\n\tfor (const node of nodes) {\r\n\t\tclassifyNode(node, i)\r\n\t\ti++\r\n\t}\r\n\r\n\treturn /**@type {const}*/ ({\r\n\t\tchildNodes, attributes,\r\n\t\tevents, animations, inlineStyles,\r\n\t\tblockStyles, watchers, conditions, iterators,\r\n\t\tlifecycles, promiseStates\r\n\t})\r\n\r\n\t/**\r\n\t * @param {any} node\r\n\t * @param {number} i\r\n\t */\r\n\tfunction classifyNode(node, i) {\r\n\t\tif (node instanceof JqElement) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\tchildNodes.push(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqFragment) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\tchildNodes.push(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqText) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\tchildNodes.push(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqAttribute) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\tattributes.push(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqList && node.nodeClass === JqAttribute) {\r\n\t\t\tfor (const attribute of node) {\r\n\t\t\t\tattribute.nodePosition = i\r\n\t\t\t\tattributes.push(attribute)\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (node instanceof JqEvent) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\tevents.push(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqWatch) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\twatchers.push(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqCondition) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\tconditions.push(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqEach) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\titerators.push(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqLifecycle) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\tlifecycles.push(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqPromiseState) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\tpromiseStates.push(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqAnimation) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\tanimations.push(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqCSSProperty) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\tinlineStyles.push(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqCSSRule) {\r\n\t\t\tnode.nodePosition = i\r\n\t\t\tblockStyles.push(node)\r\n\t\t}\r\n\t\telse if (Array.isArray(node)) {\r\n\t\t\tconst _node = /**@type {JqFragment}*/ (convertToJqNode(node, null))\r\n\t\t\t_node.nodePosition = i\r\n\t\t\tchildNodes.push(_node)\r\n\t\t}\r\n\t\telse if (typeof node == \"function\") {\r\n\t\t\tconst _node = getCallbackArg(node)\r\n\t\t\treturn classifyNode(_node, i)\r\n\t\t}\r\n\t\telse if (isPrimitive(node)) {\r\n\t\t\tconst _node = /**@type {JqText}*/ (convertToJqNode(node, null))\r\n\t\t\t_node.nodePosition = i\r\n\t\t\tchildNodes.push(_node)\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {(...a: any[]) => any} callback \r\n * @returns {JqEffectNode}\r\n */\r\nfunction getCallbackArg(callback) {\r\n\ttry {\r\n\t\tcallback()\r\n\t}\r\n\tcatch (e) {\r\n\t\tconst isJqEffectNode = () => e instanceof JqWatch\r\n\t\t\t|| e instanceof JqEvent\r\n\t\t\t|| e instanceof JqCondition\r\n\t\t\t|| e instanceof JqEach\r\n\t\t\t|| e instanceof JqLifecycle\r\n\r\n\t\tif (isJqEffectNode()) {\r\n\t\t\te.callback = callback\r\n\t\t\treturn /**@type {JqEffectNode}*/ (e)\r\n\t\t}\r\n\r\n\t\tthrow e\r\n\t}\r\n\r\n\tthrow new TypeError(`JqError - Expected a JqCallback<\"watch\" | \"event\" | \"condition\" | \"each\" | \"mount\" | \"unmount\"> but instead found a 'function'`)\r\n}\r\n\r\n/**\r\n * @param {any} value \r\n * @param {JqFragment | JqElement | null} jqParent \r\n * @returns {Exclude<JqNode, JqState | JqPromise<any>>}\r\n */\r\nexport function convertToJqNode(value, jqParent) {\r\n\t/**\r\n\t * @param {Primitive | Primitive[]} value\r\n\t */\r\n\tconst convertToJqText = (value) => {\r\n\t\tconst jqText = new JqText(/**@type {Primitive}*/(value) ?? '')\r\n\t\tjqText.jqParent = jqParent\r\n\t\treturn jqText\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Primitive[]} values\r\n\t */\r\n\tconst convertToJqFragment = (values) => {\r\n\r\n\t\tconst jqNodes = getNodes(values)\r\n\t\tconst childNodes = jqNodes.childNodes\r\n\r\n\t\tfor (let i = 0; i < childNodes.length; i++) {\r\n\t\t\tconst childNode = childNodes[i]\r\n\t\t\tchildNode.nodePosition = i\r\n\t\t}\r\n\r\n\t\tconst jqFragment = new JqFragment(childNodes)\r\n\r\n\t\tjqFragment.jqParent = jqParent\r\n\t\tjqFragment.conditions = jqNodes.conditions\r\n\t\tjqFragment.iterators = jqNodes.iterators\r\n\t\tjqFragment.lifecycles = jqNodes.lifecycles\r\n\t\tjqFragment.promisesStates = jqNodes.promiseStates\r\n\t\tjqFragment.watchers = jqNodes.watchers\r\n\r\n\t\treturn jqFragment\r\n\t}\r\n\r\n\t/**\r\n\t * @param {(..._: any[]) => any} value \r\n\t */\r\n\tconst convertToJqEffectNode = (value) => {\r\n\t\tconst jqEffectNode = getCallbackArg(value)\r\n\t\tjqEffectNode.jqParent = jqParent\r\n\t\treturn jqEffectNode\r\n\t}\r\n\r\n\tif (Array.isArray(value))\r\n\t\treturn convertToJqFragment(value)\r\n\tif (isPrimitive(value))\r\n\t\treturn convertToJqText(value)\r\n\tif (typeof value == \"function\")\r\n\t\treturn convertToJqEffectNode(value)\r\n\tif (getJqNodeConstructors().some(X => value instanceof X))\r\n\t\treturn /**@type {Exclude<JqNode, JqState | JqPromise<any>>}*/(value)\r\n\r\n\treturn throwError(`JqError - Unexpected value found in place of a JqNode`)\r\n}\r\n\r\n/**\r\n * @param {{[x: string | symbol | number]: unknown}} object \r\n * @param {string[]} props \r\n * @returns {Primitive | { [x: string | symbol]: any }}\r\n */\r\nconst getPropertyValue = (object, props) => {\r\n\tlet result = object\r\n\tfor (let i = 0; i < props.length; i++) {\r\n\t\tresult = /**@type {any}*/ (result?.[props[i]])\r\n\t\tif (isNullish(result)) return result\r\n\t}\r\n\treturn result\r\n}\r\n\r\n/**\r\n * @template T\r\n */\r\nexport class JqPromiseState {\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {JqElement | JqFragment | null}\r\n\t */\r\n\tjqParent = null\r\n\t/**\r\n\t * @type {typeof PromisePending | typeof PromiseResolved | typeof PromiseRejected}\r\n\t */\r\n\tstate\r\n\t/**\r\n\t * @type {JqPromise<T>}\r\n\t */\r\n\tjqPromise\r\n\t/**\r\n\t * @param {typeof PromisePending | typeof PromiseResolved | typeof PromiseRejected} state \r\n\t * @param {JqPromise<T>} jqPromise \r\n\t */\r\n\tconstructor(state, jqPromise) {\r\n\t\tthis.state = state\r\n\t\tthis.jqPromise = jqPromise\r\n\t}\r\n}\r\n\r\n/**\r\n * @template T\r\n */\r\nexport class JqPromise {\r\n\t/**\r\n\t * @type {typeof PromisePending | typeof PromiseResolved | typeof PromiseRejected}\r\n\t */\r\n\tstate = PromisePending\r\n\t/**\r\n\t * @type {() => Promise<T>}\r\n\t */\r\n\tcallback\r\n\t/**\r\n\t * @type {JqPromiseSubscription<T>}\r\n\t */\r\n\tsubscriptions = {\r\n\t\tpending: [],\r\n\t\tresolved: [],\r\n\t\trejected: []\r\n\t}\r\n\t/**\r\n\t * @type {Promise<T> | null}\r\n\t */\r\n\tpromise = null\r\n\t/**\r\n\t * @param {() => Promise<T>} callback \r\n\t */\r\n\tconstructor(callback) {\r\n\t\tthis.callback = callback\r\n\t}\r\n\r\n\tinvoke() {\r\n\t\tconst promise = this.promise = this.callback()\r\n\t\tthis.subscriptions[\"pending\"].forEach(sub => sub.callback(promise))\r\n\r\n\t\tpromise.then(x =>\r\n\t\t\tthis.subscriptions[\"resolved\"].forEach(sub =>\r\n\t\t\t\t(this.state = PromiseResolved, sub.callback(x))))\r\n\t\t\t.catch(x =>\r\n\t\t\t\tthis.subscriptions[\"rejected\"].forEach(sub =>\r\n\t\t\t\t\t(this.state = PromiseRejected, sub.callback(x))))\r\n\r\n\t\treturn promise\r\n\t}\r\n\t/**\r\n\t * @param {(JqPromiseSubscription<T>[\"pending\"][0] | JqPromiseSubscription<T>[\"resolved\"][0] | JqPromiseSubscription<T>[\"rejected\"][0]) & {type: keyof JqPromiseSubscription<T>}} subscription \r\n\t */\r\n\tsubscribe(subscription) {\r\n\t\tconst { subscriber, callback, type } = subscription\r\n\t\tthis.subscriptions[type].push({ subscriber, callback })\r\n\t}\r\n\t/**\r\n\t * @return {Promise<T>}\r\n\t */\r\n\tget pending() {\r\n\t\tthrow new JqPromiseState(PromisePending, this)\r\n\t}\r\n\t/**\r\n\t * @return {T}\r\n\t */\r\n\tget then() {\r\n\t\tthrow new JqPromiseState(PromiseResolved, this)\r\n\t}\r\n\t/**\r\n\t * @return {any}\r\n\t */\r\n\tget catch() {\r\n\t\tthrow new JqPromiseState(PromiseRejected, this)\r\n\t}\r\n}\r\n\r\nexport class JqLifecycle {\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {JqElement | JqFragment | null}\r\n\t */\r\n\tjqParent = null\r\n\t/**\r\n\t * @type {OnAttachCallback | OnDetachCallback}\r\n\t */\r\n\ttype\r\n\t/**\r\n\t * @type {(...x: any[]) => any}\r\n\t */\r\n\tcallback\r\n\t/**\r\n\t * \r\n\t * @param {OnAttachCallback | OnDetachCallback} type \r\n\t */\r\n\tconstructor(type) {\r\n\t\tthis.type = type\r\n\t}\r\n\r\n\tdelete = {\r\n\t\tcontext: this,\r\n\t\tdeleteSelf() {\r\n\t\t\tconst jqLifecycle = this.context\r\n\t\t\tconst jqParent = /**@type {JqElement | JqFragment}*/ (jqLifecycle.jqParent)\r\n\r\n\t\t\tconst delNodeIdx = jqParent.lifecycles.findIndex(lifecycle => Object.is(lifecycle, jqLifecycle))\r\n\t\t\tif (delNodeIdx == -1)\r\n\t\t\t\tthrowError(\"JqInternalError - JqLifecycle not found in its jqParent.lifecycles\")\r\n\r\n\t\t\tjqParent.lifecycles.splice(delNodeIdx, 1)\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * @template T\r\n */\r\nexport class JqEach {\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {JqElement | JqFragment | null}\r\n\t */\r\n\tjqParent = null\r\n\t/**\r\n\t * @type {{[Symbol.iterator]: () => IterableIterator<T>, [x: string | symbol | number]: any}}\r\n\t */\r\n\titerable\r\n\t/**\r\n\t * @type {(_: [T, number, typeof this.iterable]) => any}\r\n\t */\r\n\tcallback = (_) => ''\r\n\t/**\r\n\t * @type {JqFragment | null}\r\n\t */\r\n\treturned = null\r\n\t/**\r\n\t * @param {{[Symbol.iterator]: () => IterableIterator<T>, [x: string | symbol | number]: any}} iterable \r\n\t */\r\n\tconstructor(iterable) {\r\n\t\tthis.iterable = iterable\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {JqFragment}\r\n\t */\r\n\tinvoke() {\r\n\t\tlet i = 0\r\n\t\tconst results = []\r\n\r\n\t\tfor (const item of this.iterable) {\r\n\t\t\tconst result = this.callback([item, i, this.iterable])\r\n\t\t\tresults.push(result)\r\n\t\t\ti++\r\n\t\t}\r\n\r\n\t\tconst result = /**@type {JqFragment}*/ (convertToJqNode(results, this.jqParent))\r\n\t\tresult.nodePosition = this.nodePosition\r\n\r\n\t\treturn result\r\n\t}\r\n\r\n\tdelete = {\r\n\t\tcontext: this,\r\n\t\tdeleteSelf() {\r\n\t\t\tconst jqEach = this.context\r\n\t\t\tJqEffectNode.delete.deleteSelf(jqEach)\r\n\t\t\tjqEach.returned = null\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @type {{[x: string]: (jqEach: JqEach<any>) => any}}\r\n\t */\r\n\tstatic errors = {\r\n\t\tinvalidParent: _ => \"JqInternalError - JqEach not found in its jqParent.iterators\"\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqElement | JqFragment} jqParent\r\n\t */\r\n\tstatic getInstancesFromParent(jqParent) {\r\n\t\treturn jqParent.iterators\r\n\t}\r\n}\r\n\r\nexport class JqCondition {\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {JqElement | JqFragment | null}\r\n\t */\r\n\tjqParent = null\r\n\tcondition = false\r\n\t/**\r\n\t * @type {(_: boolean) => any}\r\n\t */\r\n\tcallback = (_) => ''\r\n\t/**\r\n\t * @type {JqElement | JqFragment | JqText | null}\r\n\t */\r\n\treturned = null\r\n\t/**\r\n\t * @param {boolean} condition \r\n\t */\r\n\tconstructor(condition) {\r\n\t\tthis.condition = condition\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {JqNode}\r\n\t */\r\n\tinvoke() {\r\n\t\tconst result = /**@type {JqCondition}*/ (getCallbackArg(this.callback))\r\n\t\tthis.condition = result.condition\r\n\r\n\t\tconst _result = this.condition ? result.callback(this.condition) : new JqText()\r\n\t\treturn _result\r\n\t}\r\n\r\n\tdelete = {\r\n\t\tcontext: this,\r\n\t\tdeleteSelf() {\r\n\t\t\tconst jqCondition = this.context\r\n\t\t\tJqEffectNode.delete.deleteSelf(jqCondition)\r\n\t\t\tjqCondition.returned = null\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @type {{[x: string]: (jqCondition: JqCondition) => any}}\r\n\t */\r\n\tstatic errors = {\r\n\t\tinvalidParent: _ => \"JqInternalError - JqCondition not found in its jqParent.conditions\"\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqElement | JqFragment} jqParent\r\n\t */\r\n\tstatic getInstancesFromParent(jqParent) {\r\n\t\treturn jqParent.conditions\r\n\t}\r\n}\r\n\r\nexport class JqEvent {\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {string}\r\n\t */\r\n\tevent\r\n\t/**\r\n\t * @param {Event} [_]\r\n\t */\r\n\tcallback\r\n\t/**\r\n\t * @type {JqElement | null}\r\n\t */\r\n\tjqParent = null\r\n\r\n\t/**\r\n\t * @param {string} event\r\n\t * @param {(event?: Event) => any} callback \r\n\t */\r\n\tconstructor(event, callback = (_) => '') {\r\n\t\tthis.event = event\r\n\t\tthis.callback = callback\r\n\t}\r\n\r\n\t/**\r\n\t * @param {HTMLElement} element \r\n\t */\r\n\tattachHandler(element) {\r\n\t\telement.addEventListener(this.event, this.callback)\r\n\t}\r\n\r\n\t/**\r\n\t * @param {HTMLElement} element \r\n\t */\r\n\tdetachHandler(element) {\r\n\t\telement.removeEventListener(this.event, this.callback)\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Node | JqElement} node\r\n\t */\r\n\tattachTo(node) {\r\n\t\tif (node instanceof HTMLElement) {\r\n\t\t\tthis.attachHandler(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqElement) {\r\n\t\t\tthis.jqParent = node\r\n\t\t\tif (!node.events.includes(this)) node.events.push(this)\r\n\t\t\tthis.attachHandler(/**@type {HTMLElement}*/(node.domNode))\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error(JqEvent.errors.invalidAttachTo(this))\r\n\t\t}\r\n\t\treturn this\r\n\t}\r\n\r\n\tdelete = {\r\n\t\tcontext: this,\r\n\t\tdeleteSelf() {\r\n\t\t\tconst jqEvent = this.context\r\n\t\t\tconst jqParent = /**@type {JqElement}*/ (jqEvent.jqParent)\r\n\t\t\tJqEffectNode.delete.deleteSelf(jqEvent)\r\n\r\n\t\t\tconst domNode = jqParent.domNode\r\n\t\t\tdomNode && jqEvent.detachHandler(domNode)\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @type {{[x: string]: (jqEvent: JqEvent) => any}}\r\n\t */\r\n\tstatic errors = {\r\n\t\tinvalidAttachTo: jqEvent => `JqError - Cannot attach JqEvent '${jqEvent.event}' to a node not of instance JqElement or JqFragment or HTMLElement`,\r\n\t\tinvalidParent: _ => \"JqInternalError - JqEvent not found in its jqParent.events\"\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqElement | JqFragment} jqParent\r\n\t */\r\n\tstatic getInstancesFromParent(jqParent) {\r\n\t\treturn jqParent instanceof JqFragment ? [] : jqParent.events\r\n\t}\r\n}\r\n\r\nexport class JqWatch {\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {JqElement | JqFragment | null}\r\n\t */\r\n\tjqParent = null\r\n\t/**\r\n\t * @type {JqState[]}\r\n\t */\r\n\tjqStates = []\r\n\t/**\r\n\t * @param {any[]} _\r\n\t * @returns {any}\r\n\t */\r\n\tcallback = (_) => ''\r\n\t/**\r\n\t * @type {JqElement | JqFragment | JqText | null}\r\n\t */\r\n\treturned = null\r\n\t/**\r\n\t * @param  {...JqState} jqStates\r\n\t */\r\n\tconstructor(...jqStates) {\r\n\t\tthis.jqStates = jqStates\r\n\t}\r\n\r\n\tinvoke() {\r\n\t\treturn this.callback(this.jqStates.map(jqState => jqState[StateReference]))\r\n\t}\r\n\r\n\treconcile() {\r\n\t\tconst oldNode = /**@type {NonNullable<typeof this.returned>}*/ (this.returned)\r\n\t\tconst newNode = JqEffectNode.extractEffectReturn(this, this.jqParent)\r\n\t\tnewNode.attachTo(null, false)\r\n\r\n\t\tconst _diff = diff(oldNode, newNode)\r\n\t\tJqWatch.reconcile(_diff)\r\n\r\n\t\tif (_diff[UPDATED].length) this.returned = newNode\r\n\r\n\t\treturn this\r\n\t}\r\n\r\n\tdelete = {\r\n\t\tcontext: this,\r\n\t\tdeleteSelf() {\r\n\t\t\tconst jqWatcher = this.context\r\n\t\t\tJqEffectNode.delete.deleteSelf(jqWatcher)\r\n\r\n\t\t\tfor (const _jqState of jqWatcher.jqStates) {\r\n\t\t\t\tconst jqState = /**@type {JqState}*/ (_jqState[JqNodeReference])\r\n\t\t\t\tjqState.delete.removeWatcher(jqWatcher)\r\n\t\t\t}\r\n\r\n\t\t\tjqWatcher.returned = null\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @type {{[x: string]: (jqWatch: JqWatch) => any}}\r\n\t */\r\n\tstatic errors = {\r\n\t\tinvalidParent: _ => \"JqInternalError - JqWatch not found in its jqParent.watchers\"\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqElement | JqFragment} jqParent\r\n\t */\r\n\tstatic getInstancesFromParent(jqParent) {\r\n\t\treturn jqParent.watchers\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Diff} _diff\r\n\t */\r\n\tstatic reconcile(_diff) {\r\n\r\n\t\tconst node1 = _diff.node1\r\n\t\tconst node2 = _diff.node2\r\n\r\n\t\tconst updatedChanges = _diff[UPDATED]\r\n\t\tconst createdChanges = _diff[CREATED]\r\n\t\tconst deletedChanges = _diff[DELETED]\r\n\r\n\t\tfor (const [firstProp, ...nestedProps] of updatedChanges) {\r\n\t\t\tif (isJqText(node1, node2)) {\r\n\t\t\t\tif (firstProp == \"text\")\r\n\t\t\t\t\tJqWatch.updateText(_diff, [firstProp, ...nestedProps])\r\n\t\t\t}\r\n\t\t\telse if (isJqAttribute(node1, node2)) {\r\n\t\t\t\tif (firstProp == \"value\")\r\n\t\t\t\t\tJqWatch.updateAttribute(_diff, [firstProp, ...nestedProps])\r\n\t\t\t}\r\n\t\t\telse if (!isNullish(node1) && !isNullish(node2)) {\r\n\t\t\t\tJqWatch.updateElement(_diff, [firstProp, ...nestedProps])\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (const [firstProp, ...nestedProps] of createdChanges) {\r\n\t\t\tif (isJqText(node1, node2)) {\r\n\r\n\t\t\t}\r\n\t\t\telse if (isJqAttribute(node1, node2)) {\r\n\r\n\t\t\t}\r\n\t\t\telse if (isJqFragment(node1, node2)) {\r\n\t\t\t\tif (firstProp == \"childNodes\")\r\n\t\t\t\t\tJqWatch.createFragment(_diff, [firstProp, ...nestedProps])\r\n\t\t\t}\r\n\t\t\telse if (isJqElement(node1, node2)) {\r\n\t\t\t\tif (firstProp == \"childNodes\")\r\n\t\t\t\t\tJqWatch.createElement(_diff, [firstProp, ...nestedProps])\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (const [firstProp, ...nestedProps] of deletedChanges) {\r\n\t\t\tif (isJqFragment(node1, node2)) {\r\n\t\t\t\tJqWatch.deleteFragmentChild(_diff, [firstProp, ...nestedProps])\r\n\t\t\t}\r\n\t\t\telse if (isJqElement(node1, node2)) {\r\n\t\t\t\tJqWatch.deleteElementChild(_diff, [firstProp, ...nestedProps])\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t\t/**@type {DiffableJqNode}*/(node1).delete.deleteSelf()\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (const diff of _diff.childDiffs) {\r\n\t\t\tJqWatch.reconcile(diff)\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Diff} diff \r\n\t * @param {[string, ...Array<string | JqNode>]} props\r\n\t */\r\n\tstatic updateAttribute(diff, props) {\r\n\t\tif (![diff.node1, diff.node2].every(node => node instanceof JqAttribute))\r\n\t\t\treturn this\r\n\t\tconst _node1 = /**@type {JqAttribute}*/ (diff.node1)\r\n\t\tconst _node2 = /**@type {JqAttribute}*/ (diff.node2)\r\n\t\treturn _node1.update.setAttribute(_node2.value)\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Diff} diff \r\n\t * @param {[string, ...Array<string | JqNode>]} props\r\n\t */\r\n\tstatic updateText(diff, props) {\r\n\t\tif (![diff.node1, diff.node2].every(node => node instanceof JqText))\r\n\t\t\treturn this\r\n\t\tconst _node1 = /**@type {JqText}*/ (diff.node1)\r\n\t\tconst _node2 = /**@type {JqText}*/ (diff.node2)\r\n\t\t_node1.update.setText(_node2.text)\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Diff} diff \r\n\t * @param {[string, ...Array<string | JqNode>]} props \r\n\t */\r\n\tstatic updateElement(diff, props) {\r\n\t\tconst _node1 = /**@type {JqElement | JqFragment | JqText}*/ (diff.node1)\r\n\t\tconst _node2 = /**@type {JqElement | JqFragment | JqText}*/ (diff.node2)\r\n\t\tconst _node1Parent = /**@type {JqElement | JqFragment}*/ (_node1.jqParent)\r\n\r\n\t\t_node1Parent.update.replaceChild(_node1, _node2)\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Diff} diff \r\n\t * @param {[string, ...Array<string | JqNode>]} param2\r\n\t */\r\n\tstatic createElement(diff, [firstProp, _childNode]) {\r\n\t\tif (![diff.node1, diff.node2].every(node => node instanceof JqElement))\r\n\t\t\treturn this\r\n\r\n\t\tconst _node1 = /**@type {JqElement}*/ (diff.node1)\r\n\t\tconst _node2 = /**@type {JqElement}*/ (diff.node2)\r\n\t\tconst childNode = /**@type {JqElement | JqFragment | JqText}*/ (_childNode)\r\n\r\n\t\tchildNode.jqParent = _node1.jqParent\r\n\t\tchildNode.nodePosition = _node1.childNodes.length\r\n\r\n\t\t_node1.childNodes.splice(_node1.childNodes.length, 0, childNode)\r\n\t\tchildNode.attachTo(_node1)\r\n\r\n\t\treturn this\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Diff} diff \r\n\t * @param {[string, ...Array<string | JqNode>]} param2\r\n\t */\r\n\tstatic createFragment(diff, [firstProp, _childNode]) {\r\n\t\tif (![diff.node1, diff.node2].every(node => node instanceof JqFragment))\r\n\t\t\treturn this\r\n\r\n\t\tconst _node1 = /**@type {JqFragment}*/ (diff.node1)\r\n\t\tconst _node2 = /**@type {JqFragment}*/ (diff.node2)\r\n\t\tconst childNode = /**@type {JqElement | JqFragment | JqText}*/ (_childNode)\r\n\r\n\t\tchildNode.jqParent = _node1.jqParent\r\n\t\tchildNode.nodePosition = _node1.childNodes.length\r\n\r\n\t\tchildNode.attachTo(_node1)\r\n\r\n\t\treturn this\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Diff} diff \r\n\t * @param {[string, ...Array<string | JqNode>]} param2 \r\n\t */\r\n\tstatic deleteFragmentChild(diff, [firstProp, _childNode]) {\r\n\t\tconst _node1 = /**@type {JqFragment}*/(diff.node1)\r\n\t\tconst _node2 = /**@type {JqFragment}*/ (diff.node2)\r\n\r\n\t\tconst childNode = /**@type {JqElement | JqFragment | JqText}*/(_childNode)\r\n\t\tchildNode.delete.deleteSelf()\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Diff} diff \r\n\t * @param {[string, ...Array<string | JqNode>]} param2 \r\n\t */\r\n\tstatic deleteElementChild(diff, [firstProp, _childNode]) {\r\n\t\tconst _node1 = /**@type {JqElement}*/ (diff.node1)\r\n\t\tconst _node2 = /**@type {JqElement}*/ (diff.node2)\r\n\r\n\t\tconst childNode = /**@type {JqElement | JqFragment | JqText}*/ (_childNode)\r\n\t\tchildNode.delete.deleteSelf()\r\n\t}\r\n}\r\n\r\nexport class JqState {\r\n\t/**\r\n\t * @type {typeof this}\r\n\t */\r\n\t[JqNodeReference];\r\n\t/**\r\n\t * @type {{ [x: string | symbol]: unknown }}\r\n\t */\r\n\t[StateReference];\r\n\r\n\t/**\r\n\t * @type {JqWatch[]}\r\n\t */\r\n\twatchers = []\r\n\r\n\t/**\r\n\t * @param {{ [x: string | symbol]: unknown }} state \r\n\t */\r\n\tconstructor(state) {\r\n\t\tthis[StateReference] = state\r\n\t\tthis[JqNodeReference] = this\r\n\t}\r\n\r\n\tdelete = {\r\n\t\tcontext: this,\r\n\t\t/**\r\n\t\t * @param {JqWatch} watcher\r\n\t\t */\r\n\t\tremoveWatcher(watcher) {\r\n\t\t\tconst jqState = this.context\r\n\t\t\tconst delNodeIdx = jqState.watchers.findIndex(_watcher => Object.is(_watcher, watcher))\r\n\r\n\t\t\tif (delNodeIdx == -1)\r\n\t\t\t\tthrowError(\"JqInternalError - JqWatcher not found in one of its jqState.watchers\")\r\n\t\t\tjqState.watchers.splice(delNodeIdx, 1)\r\n\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class JqAnimation {\r\n\t/**\r\n\t * @type {Animation | null}\r\n\t */\r\n\tdomAnimation = null\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {Parameters<AnimateFn>}\r\n\t */\r\n\tparameters\r\n\t/**\r\n\t * @type {JqElement | null}\r\n\t */\r\n\tjqParent = null\r\n\r\n\t/**\r\n\t * \r\n\t * @param  {Parameters<AnimateFn>} parameters \r\n\t */\r\n\tconstructor(...parameters) {\r\n\t\tthis.parameters = parameters\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Node | JqElement} node\r\n\t */\r\n\tattachTo(node) {\r\n\t\tif (node instanceof HTMLElement) {\r\n\t\t\tthis.animate(node)\r\n\t\t}\r\n\t\telse if (node instanceof JqElement) {\r\n\t\t\tthis.jqParent = node\r\n\t\t\tthis.animate(/**@type {HTMLElement}*/(node.domNode))\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error(`JqError - Cannot attach JqAnimation to a node not of instance JqElement or JqFragment or HTMLElement`)\r\n\t\t}\r\n\t\treturn this\r\n\t}\r\n\r\n\t/**\r\n\t * @param {HTMLElement} element \r\n\t * @returns {ReturnType<AnimateFn>}\r\n\t */\r\n\tanimate(element) {\r\n\r\n\t\tconst [_styles, _options, ..._moreOptions] = this.parameters\r\n\r\n\t\t/**\r\n\t\t * @type {((..._: unknown[]) => unknown) | null}\r\n\t\t */\r\n\t\tlet callback = null\r\n\t\tlet options = /**@type {Parameters<Element[\"animate\"]>[1]}*/ (isPrimitive(_options) ? null : _options)\r\n\r\n\t\tconst [speed, easing, _callback] = [_options, ..._moreOptions]\r\n\t\tif (_callback) callback = _callback\r\n\t\tconst option = {\r\n\t\t\tduration: speed ?? 400,\r\n\t\t\teasing: easing ?? \"linear\",\r\n\t\t\tfill: \"forwards\"\r\n\t\t}\r\n\r\n\t\toptions ??= /**@type {Parameters<Element[\"animate\"]>[1]}*/ (option)\r\n\r\n\t\tconst __styles = (Array.isArray(_styles)\r\n\t\t\t? _styles.map(x => x instanceof Map ? Object.fromEntries(x) : x)\r\n\t\t\t: _styles instanceof Map ? Object.fromEntries(_styles) : _styles)\r\n\r\n\t\tconst styles = /**@type {Parameters<Element[\"animate\"]>[0]}*/ (Array.isArray(__styles)\r\n\t\t\t? __styles.map(x => JqAnimation.setInitialStyles(element, x))\r\n\t\t\t: JqAnimation.setInitialStyles(element, __styles))\r\n\r\n\t\tthis.domAnimation = element.animate(styles, options)\r\n\t\tcallback && this.domAnimation.addEventListener(\"finish\", callback)\r\n\r\n\t\treturn this.domAnimation\r\n\t}\r\n\r\n\t/**\r\n\t * @param {HTMLElement} element \r\n\t * @param {{ [styleName: string]: Primitive | Primitive[] }} styles \r\n\t * @param  {unknown[]} _ \r\n\t * @returns \r\n\t */\r\n\tstatic setInitialStyles(element, styles, ..._) {\r\n\t\tconst styleNames = Object.keys(styles).filter(styleName => !Array.isArray(styles[styleName]))\r\n\t\tconst _styles = styleNames.map(styleName => {\r\n\t\t\tconst finalStyleValue = /**@type {Primitive}*/ (styles[styleName])\r\n\t\t\tconst initialStyleValue = getComputedStyle(element).getPropertyValue(styleName)\r\n\r\n\t\t\treturn [styleName, [initialStyleValue, finalStyleValue]]\r\n\t\t})\r\n\r\n\t\treturn { ...styles, ...Object.fromEntries(_styles) }\r\n\t}\r\n}\r\n\r\nexport class JqCSSProperty {\r\n\t/**\r\n\t * @type {string}\r\n\t */\r\n\tname\r\n\t/**\r\n\t * @type {string}\r\n\t */\r\n\tvalue\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {JqElement | null}\r\n\t */\r\n\tjqParent = null\r\n\r\n\t/**\r\n\t * @param {string} name \r\n\t * @param {unknown} value \r\n\t */\r\n\tconstructor(name, value) {\r\n\t\tthis.name = camelToKebab(name).replace(/_/g, '-')\r\n\t\tthis.value = String(value)\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Node | JqElement} node\r\n\t */\r\n\tattachTo(node) {\r\n\t\tif (node instanceof HTMLElement) {\r\n\t\t\tnode.style.setProperty(this.name, this.value)\r\n\t\t}\r\n\t\telse if (node instanceof JqElement) {\r\n\t\t\tthis.jqParent = node\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error(JqCSSProperty.errors.invalidAttachTo(this))\r\n\t\t}\r\n\t\treturn this\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {string}\r\n\t */\r\n\ttoString(indent = 1) {\r\n\t\treturn `${this.name}: ${this.value};`\r\n\t}\r\n\r\n\t/**\r\n\t * @type {{[x: string]: (jqCSSProperty: JqCSSProperty) => string}}\r\n\t */\r\n\tstatic errors = {\r\n\t\tinvalidAttachTo: _ => `JqError - Cannot attach JqCSSProperty to a node not of instance JqElement or JqFragment or HTMLElement`\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqCSSProperty} jqCSSProperty \r\n\t * @returns {JqFragment}\r\n\t */\r\n\tstatic getStyleFragment(jqCSSProperty) {\r\n\t\tconst nameNode = new JqText(jqCSSProperty.name)\r\n\t\tconst valueNode = new JqText(jqCSSProperty.value)\r\n\r\n\t\tconst childNodes = getNodes([\r\n\t\t\tnameNode, new JqText(': '), valueNode, new JqText(';')\r\n\t\t]).childNodes\r\n\r\n\t\treturn new JqFragment(childNodes)\r\n\t}\r\n}\r\n\r\nexport class JqCSSRule {\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {[string, ...string[]]}\r\n\t */\r\n\thead\r\n\t/**\r\n\t * @type {Array<JqCSSProperty | JqCSSRule>}\r\n\t */\r\n\tbody = []\r\n\t/**\r\n\t * @type {JqElement | null}\r\n\t */\r\n\tjqParent = null\r\n\r\n\t/**\r\n\t * @param {[string, ...string[]]} param0 \r\n\t * @param  {(Array<JqCSSProperty | JqCSSRule> | { [x: string]: Primitive }[])} styleNodes \r\n\t */\r\n\tconstructor([ruleName, ...ruleArgs], ...styleNodes) {\r\n\r\n\t\tthis.head = [ruleName, ...ruleArgs]\r\n\r\n\t\tconst errorMessage = JqCSSRule.errors.invalidHeadArgument(this)\r\n\t\tthis.body = styleNodes.flatMap(styleNode =>\r\n\t\t\tstyleNode instanceof JqCSSProperty || styleNode instanceof JqCSSRule\r\n\t\t\t\t? styleNode\r\n\t\t\t\t: createPropertyListFromStyleObject(errorMessage, styleNode).nodes\r\n\t\t)\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Node | JqElement} node\r\n\t */\r\n\tattachTo(node) {\r\n\t\tif (node instanceof HTMLElement) {\r\n\t\t\tconst styleEl = document.createElement('style')\r\n\t\t\tstyleEl.textContent = this.toString()\r\n\t\t\tnode.appendChild(styleEl)\r\n\t\t}\r\n\t\telse if (node instanceof JqElement) {\r\n\t\t\tthis.jqParent = node\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error(JqCSSRule.errors.invalidAttachTo(this))\r\n\t\t}\r\n\t\treturn this\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {string}\r\n\t */\r\n\ttoString(indent = 1) {\r\n\t\tconst space = '\\t'.repeat(indent)\r\n\t\tlet head = this.head.join(' ').trim()\r\n\t\treturn `${head} {\\n${space}${this.body.map(styleNode => styleNode.toString(indent + 1)).join('\\n' + space)}\\n${'\\t'.repeat(indent - 1)}}`\r\n\t}\r\n\r\n\t/**\r\n\t * @type {{[x: string]: (jqCSSRule: JqCSSRule) => string}}\r\n\t */\r\n\tstatic errors = {\r\n\t\tinvalidAttachTo: _ => `JqError - Cannot attach JqCSSRule to a node not of instance JqElement or JqFragment or HTMLElement`,\r\n\t\tinvalidHeadArgument: jqCSSRule => `JqError - Invalid argument passed to ${jqCSSRule.head.join(' ').trim()}(...)`\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqCSSRule} jqCSSRule \r\n\t * @returns {JqFragment}\r\n\t */\r\n\tstatic getStyleFragment(jqCSSRule) {\r\n\t\tconst headFragment = new JqFragment(getNodes(jqCSSRule.head).childNodes)\r\n\t\tconst styleFragments = jqCSSRule.body.map(x =>\r\n\t\t\tJqStyleNode.getStyleClass(x).getStyleFragment(/**@type {any}*/(x)))\r\n\r\n\t\tconst childNodes = getNodes([\r\n\t\t\theadFragment, new JqText(' {\\n'),\r\n\t\t\t...styleFragments, new JqText('\\n}')\r\n\t\t]).childNodes\r\n\r\n\t\treturn new JqFragment(childNodes)\r\n\t}\r\n}\r\n\r\n/**\r\n * @template {JqNode} U\r\n * @template {{ new(...x: any[]): U }} T\r\n */\r\nexport class JqList {\r\n\t/**\r\n\t * @type {U[]}\r\n\t */\r\n\tnodes = []\r\n\t/**\r\n\t * @type {T}\r\n\t */\r\n\tnodeClass\r\n\r\n\t/**\r\n\t * @param {T} nodeClass \r\n\t * @param {U[]} nodes \r\n\t */\r\n\tconstructor(nodeClass, nodes) {\r\n\t\tthis.nodeClass = nodeClass\r\n\t\tthis.nodes = nodes\r\n\t}\r\n\r\n\t/**\r\n\t * @param {U} node \r\n\t */\r\n\tpush(node) {\r\n\t\tif (!(node instanceof this.nodeClass))\r\n\t\t\tthrow new TypeError(`JqError - Cannot push node not of instance '${this.nodeClass.name}' into JqList<${this.nodeClass.name}>`)\r\n\t\tthis.nodes.push(node)\r\n\t}\r\n\r\n\tpop() {\r\n\t\treturn this.nodes.pop()\r\n\t}\r\n\r\n\t[Symbol.iterator] = () => this.nodes[Symbol.iterator]()\r\n}\r\n\r\nexport class JqAttribute {\r\n\t/**\r\n\t * @type {string}\r\n\t */\r\n\t_name = ''\r\n\t/**\r\n\t * @type {string}\r\n\t */\r\n\t_value = ''\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {Attr | null}\r\n\t */\r\n\tattrNode = null\r\n\t/**\r\n\t * @type {JqElement | null}\r\n\t */\r\n\tjqParent = null\r\n\r\n\t/**\r\n\t * @param {string} name \r\n\t * @param {string} value \r\n\t */\r\n\tconstructor(name, value) {\r\n\t\tthis.name = camelToKebab(name).replace(/_/g, '-')\r\n\t\tthis.value = value\r\n\t}\r\n\r\n\tget name() {\r\n\t\treturn this._name\r\n\t}\r\n\t/**\r\n\t * @param {string} attrName\r\n\t */\r\n\tset name(attrName) {\r\n\t\tthis._name = attrName\r\n\t}\r\n\tget value() {\r\n\t\treturn this._value\r\n\t}\r\n\t/**\r\n\t * @param {string} attrValue\r\n\t */\r\n\tset value(attrValue) {\r\n\t\tthis._value = attrValue\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Node | JqElement} node\r\n\t */\r\n\tattachTo(node) {\r\n\t\tthis.initial.createNode()\r\n\t\tif (node instanceof HTMLElement) {\r\n\t\t\tnode.setAttributeNode(/**@type {Attr}*/(this.attrNode))\r\n\t\t}\r\n\t\telse if (node instanceof JqElement) {\r\n\t\t\tthis.jqParent = node;\r\n\t\t\t/**@type {HTMLElement}*/ (node.domNode).setAttributeNode(/**@type {Attr}*/(this.attrNode))\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new TypeError(`JqError - Cannot attach JqAttribute '${this.name}' to a node not of instance JqElement or JqFragment or HTMLElement`)\r\n\t\t}\r\n\t\treturn this\r\n\t}\r\n\r\n\tinitial = {\r\n\t\tcontext: this,\r\n\t\tcreateNode() {\r\n\t\t\tconst jqAttribute = this.context\r\n\t\t\tjqAttribute.attrNode = document.createAttribute(jqAttribute.name)\r\n\t\t\tjqAttribute.attrNode.value = jqAttribute.value\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\tupdate = {\r\n\t\tcontext: this,\r\n\t\tupdateAttribute() {\r\n\t\t\tconst jqAttribute = this.context;\r\n\t\t\t/**@type {Attr}*/ (jqAttribute.attrNode).value = jqAttribute.value\r\n\t\t\treturn this\r\n\t\t},\r\n\t\t/**\r\n\t\t * @param {string} value\r\n\t\t */\r\n\t\tsetAttribute(value) {\r\n\t\t\tconst jqAttribute = this.context\r\n\t\t\tif (value === jqAttribute.value) return this\r\n\r\n\t\t\tjqAttribute.value = value;\r\n\t\t\t/**@type {Attr}*/ (jqAttribute.attrNode).value = value\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\tdelete = {\r\n\t\tcontext: this,\r\n\t\tdeleteSelf() {\r\n\t\t\tconst jqAttribute = this.context\r\n\t\t\tconst jqElement = jqAttribute.jqParent\r\n\r\n\t\t\tif (!jqElement) return this\r\n\t\t\tjqElement.delete.removeAttribute(jqAttribute)\r\n\r\n\t\t\tjqAttribute.attrNode = null\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {{ [x: string]: Primitive }} attrObj\r\n\t */\r\n\tstatic objectToJqAttributes(attrObj) {\r\n\r\n\t\tif (attrObj === null || typeof attrObj !== \"object\")\r\n\t\t\tthrow new TypeError(`JqError - Invalid argument passed to attr(...)`)\r\n\r\n\t\tconst attrList = Object.entries(attrObj)\r\n\t\t\t.map(([key, value]) => {\r\n\t\t\t\tconst _name = camelToKebab(key).replace(/_/g, '-')\r\n\t\t\t\tconst _value = String(value)\r\n\r\n\t\t\t\tconst attribute = new JqAttribute(_name, _value)\r\n\t\t\t\treturn attribute\r\n\t\t\t})\r\n\r\n\t\treturn new JqList(JqAttribute, attrList)\r\n\t}\r\n}\r\n\r\nexport class JqText {\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {JqElement | JqFragment | null}\r\n\t */\r\n\tjqParent = null\r\n\t/**\r\n\t * @type {Text | null}\r\n\t */\r\n\tdomNode = null\r\n\ttext = ''\r\n\r\n\t/**\r\n\t * @param  {Array<Primitive>} primitives\r\n\t */\r\n\tconstructor(...primitives) {\r\n\t\tthis.text = primitives.map(primitive => String(primitive ?? '')).join('')\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Node | JqElement | JqFragment | null} node \r\n\t * @returns \r\n\t */\r\n\tattachTo(node, alterDomNode = true) {\r\n\r\n\t\tif (node === null) {\r\n\t\t\treturn this.toString()\r\n\t\t}\r\n\r\n\t\tthis.initial.createNode()\r\n\t\tif (node instanceof HTMLElement) {\r\n\t\t\talterDomNode && node.appendChild(/**@type {Text}*/(this.domNode))\r\n\t\t\treturn this.toString()\r\n\t\t}\r\n\t\telse if (node instanceof JqElement) {\r\n\t\t\tthis.jqParent = node\r\n\t\t\tif (!node.childNodes.includes(this)) {\r\n\t\t\t\tnode.childNodes.splice(this.nodePosition, 0, this)\r\n\t\t\t}\r\n\t\t\talterDomNode && (node.shadowRoot ?? /**@type {HTMLElement}*/ (node.domNode))\r\n\t\t\t\t.appendChild(/**@type {Text}*/(this.domNode))\r\n\t\t}\r\n\t\telse if (node instanceof JqFragment) {\r\n\t\t\tthis.jqParent = node\r\n\t\t\tif (!node.childNodes.includes(this)) {\r\n\t\t\t\tnode.childNodes.splice(this.nodePosition, 0, this)\r\n\t\t\t}\r\n\t\t\talterDomNode && /**@type {Node}*/ (node.domNode).appendChild(/**@type {Node}*/(this.domNode))\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new TypeError(JqText.errors.invalidAttachTo(this))\r\n\t\t}\r\n\r\n\t\treturn this.toString()\r\n\t}\r\n\r\n\ttoString(indent = 0) {\r\n\t\treturn this.text\r\n\t}\r\n\r\n\tinitial = {\r\n\t\tcontext: this,\r\n\t\tcreateNode() {\r\n\t\t\tconst jqElement = this.context\r\n\t\t\tjqElement.domNode = document.createTextNode(jqElement.text)\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\tupdate = {\r\n\t\tcontext: this,\r\n\t\t/**\r\n\t\t * @param {string} text \r\n\t\t */\r\n\t\tsetText(text) {\r\n\t\t\tconst jqText = this.context;\r\n\t\t\t/**@type {Text}*/ (jqText.domNode).nodeValue = jqText.text = text\r\n\t\t}\r\n\t}\r\n\r\n\tdelete = {\r\n\t\tcontext: this,\r\n\t\tdeleteSelf() {\r\n\t\t\tconst jqText = this.context\r\n\t\t\tconst jqParent = /**@type {JqElement | JqFragment}*/ (jqText.jqParent)\r\n\r\n\t\t\tconst delChildIdx = jqParent.childNodes.findIndex(childNode => Object.is(childNode, jqText))\r\n\r\n\t\t\tjqParent.childNodes.splice(delChildIdx, 1);\r\n\t\t\t/**@type {Text}*/ (jqText.domNode).remove()\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @type {{[x: string]: (jqText: JqText) => any}}\r\n\t */\r\n\tstatic errors = {\r\n\t\tinvalidAttachTo: _ => `JqError - Cannot attach JqText to a node not of instance JqElement or JqFragment or HTMLElement`\r\n\t}\r\n}\r\n\r\nexport class JqFragment {\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {JqElement | JqFragment | null}\r\n\t */\r\n\tjqParent = null\r\n\t/**\r\n\t * @type {Node | null}\r\n\t */\r\n\tdomNode = null\r\n\t/**\r\n\t * @type {Array<JqElement | JqFragment | JqText>}\r\n\t */\r\n\tchildNodes = []\r\n\t/**\r\n\t * @type {JqWatch[]}\r\n\t */\r\n\twatchers = []\r\n\t/**\r\n\t * @type {JqCondition[]}\r\n\t */\r\n\tconditions = []\r\n\t/**\r\n\t * @type {JqEach<any>[]}\r\n\t */\r\n\titerators = []\r\n\t/**\r\n\t * @type {JqLifecycle[]}\r\n\t */\r\n\tlifecycles = []\r\n\t/**\r\n\t * @type {JqPromiseState<any>[]}\r\n\t */\r\n\tpromisesStates = []\r\n\t/**\r\n\t * @type {JqElement | null}\r\n\t */\r\n\tscopedStyleSheet = null\r\n\r\n\t/**\r\n\t * @param {Array<JqElement | JqFragment | JqText>} childNodes \r\n\t */\r\n\tconstructor(childNodes) {\r\n\t\tthis.childNodes = childNodes\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Node | JqElement | JqFragment | null} node\r\n\t */\r\n\tattachTo(node, alterDomNode = true) {\r\n\t\treturn JqParentable.attachTo(this, node, JqFragment.attachNode, alterDomNode)\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {string}\r\n\t */\r\n\ttoString(indent = 0) {\r\n\t\treturn this.childNodes.map(x => x.toString(indent)).join('\\n' + '\\t'.repeat(indent))\r\n\t}\r\n\r\n\tinitial = {\r\n\t\tcontext: this,\r\n\t\tcreateNode() {\r\n\t\t\tconst jqFragment = this.context\r\n\t\t\tjqFragment.domNode = document.createDocumentFragment()\r\n\t\t\treturn this\r\n\t\t},\r\n\t\tattachChildren(alterDomNode = true) {\r\n\t\t\tconst jqFragment = this.context\r\n\t\t\tJqParentable.initial.attachChildren(jqFragment, alterDomNode)\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\tupdate = {\r\n\t\tcontext: this,\r\n\t\t/**\r\n\t\t * @param {JqElement | JqFragment | JqText} oldChildNode \r\n\t\t * @param {JqElement | JqFragment | JqText} newChildNode\r\n\t\t */\r\n\t\treplaceChild(oldChildNode, newChildNode) {\r\n\t\t\tconst jqFragment = this.context\r\n\t\t\tJqParentable.update.replaceChild(jqFragment, oldChildNode, newChildNode)\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\tdelete = {\r\n\t\tcontext: this,\r\n\t\tdeleteSelf() {\r\n\t\t\tconst jqFragment = this.context\r\n\t\t\tJqParentable.delete.deleteSelf(jqFragment)\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @type {{\r\n\t*    [x: string]: (jqFragment: JqFragment) => string\r\n\t* }}\r\n\t*/\r\n\tstatic errors = {\r\n\t\tinvalidAttachTo: jqFragment => `JqError - Cannot attach JqFragment to a node not of instance JqElement or JqFragment or HTMLElement`,\r\n\t\tchildNodeNotFound: _ => \"JqInternalError - childNode not found in JqFragment.childNodes\",\r\n\t\tinvalidParent: _ => \"JqInternalError - JqFragment not found in its jqParent.childNodes\"\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqFragment} node\r\n\t * @param {JqElement | JqFragment | HTMLElement | null} parentNode\r\n\t * @param {boolean} alterDomNode\r\n\t */\r\n\tstatic attachNode(node, parentNode, alterDomNode) {\r\n\t\tif (alterDomNode) return node.initial\r\n\t\t\t.createNode()\r\n\t\t\t.attachChildren()\r\n\t\treturn node.initial.attachChildren(alterDomNode)\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqFragment} jqFragment \r\n\t * @param {JqEffectNode[]} jqEffectNodes \r\n\t */\r\n\tstatic collectDetachableEffectNodes(jqFragment, jqEffectNodes) { }\r\n}\r\n\r\nexport class JqElement {\r\n\t/**\r\n\t * @type {string}\r\n\t */\r\n\tname\r\n\tnodePosition = -1\r\n\t/**\r\n\t * @type {JqElement | JqFragment | null}\r\n\t */\r\n\tjqParent = null\r\n\t/**\r\n\t * @type {ShadowRoot | null}\r\n\t */\r\n\tshadowRoot = null\r\n\t/**\r\n\t * @type {HTMLElement | null}\r\n\t */\r\n\tdomNode = null\r\n\t/**\r\n\t * @type {Array<JqElement | JqFragment | JqText>}\r\n\t */\r\n\tchildNodes = []\r\n\t/**\r\n\t * @type {JqAttribute[]}\r\n\t */\r\n\tattributes = []\r\n\t/**\r\n\t * @type {JqEvent[]}\r\n\t */\r\n\tevents = []\r\n\t/**\r\n\t * @type {JqAnimation[]}\r\n\t */\r\n\tanimations = []\r\n\t/**\r\n\t * @type {Array<JqCSSProperty>}\r\n\t */\r\n\tinlineStyles = []\r\n\t/**\r\n\t * @type {Array<JqCSSRule>}\r\n\t */\r\n\tblockStyles = []\r\n\t/**\r\n\t * @type {JqWatch[]}\r\n\t */\r\n\twatchers = []\r\n\t/**\r\n\t * @type {JqCondition[]}\r\n\t */\r\n\tconditions = []\r\n\t/**\r\n\t * @type {JqEach<any>[]}\r\n\t */\r\n\titerators = []\r\n\t/**\r\n\t * @type {JqLifecycle[]}\r\n\t */\r\n\tlifecycles = []\r\n\t/**\r\n\t * @type {JqPromiseState<any>[]}\r\n\t */\r\n\tpromisesStates = []\r\n\t/**\r\n\t * @type {JqElement | null}\r\n\t */\r\n\tscopedStyleSheet = null\r\n\tid = \"jq\" + createHash()\r\n\r\n\t/**\r\n\t * @param {string} name \r\n\t * @param {JqElementParameters} props \r\n\t */\r\n\tconstructor(name, props) {\r\n\t\tthis.name = name\r\n\t\tObject.assign(this, props)\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Node | JqElement | JqFragment | null} node\r\n\t */\r\n\tattachTo(node, alterDomNode = true) {\r\n\t\treturn JqParentable.attachTo(this, node, JqElement.attachNode, alterDomNode)\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {string}\r\n\t */\r\n\ttoString(indent = 0) {\r\n\t\tconst emptyTags = [\r\n\t\t\t\"area\", \"base\", \"br\",\r\n\t\t\t\"col\", \"embed\", \"hr\",\r\n\t\t\t\"img\", \"input\", \"link\",\r\n\t\t\t\"meta\", \"param\", \"source\",\r\n\t\t\t\"track\", \"wbr\"\r\n\t\t]\r\n\r\n\t\t/**\r\n\t\t * @param {number} length\r\n\t\t */\r\n\t\tconst hasElmStartIndent = (length) => length > 0 ? '\\n' + '\\t'.repeat(indent + 1) : ''\r\n\r\n\t\t/**\r\n\t\t * @param {number} length\r\n\t\t */\r\n\t\tconst hasElmEndIndent = (length) => length > 0 ? '\\n' + '\\t'.repeat(indent) : ''\r\n\t\tconst emptyTagSelfClosure = emptyTags.includes(this.name) ? '/' : ''\r\n\r\n\t\tconst childMarkup = this.childNodes.map(x => x.toString(indent + 1)).join('\\n' + '\\t'.repeat(indent + 1))\r\n\t\tconst selfAttrs = this.attributes.map(x => `${x.name} = \"${String(x.value ?? '')}\"`).join(\" \")\r\n\t\tconst selfCallbacks = this.watchers.map(x => x.returned?.toString(indent + 1) ?? '').join('\\n' + '\\t'.repeat(indent))\r\n\r\n\t\tconst selfMarkupHead = `<${this.name}${selfAttrs.length ? ' ' : ''}${selfAttrs}${emptyTagSelfClosure}>`\r\n\t\tconst selfMarkupTail = `${hasElmStartIndent(childMarkup.length || selfCallbacks.length) +\r\n\t\t\tchildMarkup +\r\n\t\t\t(selfCallbacks.length ? hasElmStartIndent(childMarkup.length) + selfCallbacks : '') +\r\n\t\t\thasElmEndIndent(childMarkup.length || selfCallbacks.length)}</${this.name}>`\r\n\t\tconst selfMarkup = `${selfMarkupHead}${!emptyTagSelfClosure ? selfMarkupTail : ''}`\r\n\r\n\t\treturn selfMarkup\r\n\t}\r\n\r\n\tinitial = {\r\n\t\tcontext: this,\r\n\t\tcreateNode() {\r\n\t\t\tconst jqElement = this.context\r\n\t\t\tjqElement.domNode = document.createElement(jqElement.name)\r\n\t\t\treturn this\r\n\t\t},\r\n\t\tattachAttributes() {\r\n\t\t\tconst jqElement = this.context\r\n\t\t\tfor (const attribute of jqElement.attributes) {\r\n\t\t\t\tattribute.attachTo(jqElement)\r\n\t\t\t}\r\n\t\t\treturn this\r\n\t\t},\r\n\t\tattachChildren(alterDomNode = true) {\r\n\t\t\tconst jqElement = this.context\r\n\t\t\tJqParentable.initial.attachChildren(jqElement, alterDomNode)\r\n\t\t\treturn this\r\n\t\t},\r\n\t\tattachEventListeners() {\r\n\t\t\tconst jqElement = this.context\r\n\t\t\tfor (const jqEvent of jqElement.events) {\r\n\t\t\t\tjqEvent.attachTo(jqElement)\r\n\t\t\t}\r\n\t\t\treturn this\r\n\t\t},\r\n\t\tattachAnimations() {\r\n\t\t\tconst jqElement = this.context\r\n\t\t\tif (jqElement.animations.length == 0) return this\r\n\r\n\t\t\tobserveElement(/**@type {HTMLElement}*/(jqElement.domNode), ([entry, observer]) => {\r\n\t\t\t\tif (entry.isIntersecting) {\r\n\t\t\t\t\tfor (const animation of jqElement.animations) {\r\n\t\t\t\t\t\tanimation.attachTo(jqElement)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tobserver.disconnect()\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\treturn this\r\n\t\t},\r\n\t\t/**\r\n\t\t * @param {JqElement | JqFragment | HTMLElement | null} parentNode\r\n\t\t */\r\n\t\tattachStyles(parentNode) {\r\n\t\t\tconst jqElement = this.context\r\n\t\t\tJqElement.attachStyles(jqElement, parentNode)\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\tupdate = {\r\n\t\tcontext: this,\r\n\t\t/**\r\n\t\t * @param {JqElement | JqFragment | JqText} oldChildNode \r\n\t\t * @param {JqElement | JqFragment | JqText} newChildNode\r\n\t\t */\r\n\t\treplaceChild(oldChildNode, newChildNode) {\r\n\t\t\tconst jqElement = this.context\r\n\t\t\tJqParentable.update.replaceChild(jqElement, oldChildNode, newChildNode)\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\tdelete = {\r\n\t\tcontext: this,\r\n\t\t/**\r\n\t\t * @param {JqAttribute} jqAttribute\r\n\t\t */\r\n\t\tremoveAttribute(jqAttribute) {\r\n\t\t\tconst jqElement = this.context\r\n\t\t\tconst indexOfAttr = jqElement.attributes.indexOf(jqAttribute)\r\n\r\n\t\t\tif (indexOfAttr != -1)\r\n\t\t\t\tjqElement.attributes.splice(indexOfAttr, 1);\r\n\r\n\t\t\t/**@type {HTMLElement}*/ (jqElement.domNode).removeAttribute(jqAttribute.name)\r\n\t\t\treturn this\r\n\t\t},\r\n\t\tdeleteSelf() {\r\n\t\t\tconst jqElement = this.context\r\n\t\t\tJqParentable.delete.deleteSelf(jqElement);\r\n\t\t\t/**@type {HTMLElement}*/ (jqElement.domNode).remove()\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {HTMLElement} context \r\n\t * @param {string} name \r\n\t * @param {JqElementParameters} nodes\r\n\t */\r\n\tstatic custom = (context, name, nodes) => {\r\n\t\treturn new JqElement(name, { ...nodes, domNode: context })\r\n\t}\r\n\r\n\t/**\r\n\t * @type {{\r\n\t *    [x: string]: (jqElement: JqElement) => string\r\n\t * }}\r\n\t */\r\n\tstatic errors = {\r\n\t\tinvalidAttachTo: jqElement => `JqError - Cannot attach JqElement '${jqElement.name}' to a node not of instance JqElement or JqFragment or HTMLElement`,\r\n\t\tchildNodeNotFound: _ => \"JqInternalError - childNode not found in JqElement.childNodes\",\r\n\t\tinvalidParent: _ => \"JqInternalError - JqElement not found in its jqParent.childNodes\",\r\n\t\tunstylableElement: jqElement => `JqError - The HTML '${jqElement.name}' Element cannot be styled`\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqElement} node\r\n\t * @param {JqElement | JqFragment | HTMLElement | null} parentNode\r\n\t * @param {boolean} alterDomNode\r\n\t */\r\n\tstatic attachNode(node, parentNode, alterDomNode) {\r\n\t\tif (alterDomNode) return node.initial\r\n\t\t\t.createNode()\r\n\t\t\t.attachStyles(parentNode)\r\n\t\t\t.attachAttributes()\r\n\t\t\t.attachChildren()\r\n\t\t\t.attachEventListeners()\r\n\t\t\t.attachAnimations()\r\n\t\treturn node.initial.attachChildren(alterDomNode)\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqElement} jqElement\r\n\t * @param {JqElement | JqFragment | HTMLElement | null} parentNode\r\n\t */\r\n\tstatic attachStyles(jqElement, parentNode) {\r\n\t\tconst {\r\n\t\t\tformatSelectorAndGetStyleFragment: resolvePseudoClsAndGetStyleFragment,\r\n\t\t\tmaybeAttachStyleElementToHTMLParent,\r\n\t\t\tattachStylesToStylesheet,\r\n\t\t} = JqStyleNode\r\n\r\n\t\tconst isNonStylable = /style|script|template|link|meta|br|head|wbr|title|track/i.test(jqElement.name)\r\n\r\n\t\tif (parentNode == null) return\r\n\t\tmaybeAttachStyleElementToHTMLParent(jqElement, parentNode, isNonStylable)\r\n\r\n\t\tif (jqElement.blockStyles.length == 0 && jqElement.inlineStyles.length == 0) return\r\n\t\tif (isNonStylable) throwError(JqElement.errors.unstylableElement(jqElement))\r\n\r\n\t\tconst domNode = /**@type {HTMLElement}*/ (jqElement.domNode)\r\n\t\tdomNode.classList.add(jqElement.id)\r\n\r\n\t\tconst blockStyle = new JqCSSRule(['.' + jqElement.id], ...jqElement.inlineStyles)\r\n\t\tconst styleFragments = Array\r\n\t\t\t.from(jqElement.blockStyles, x => resolvePseudoClsAndGetStyleFragment(x, jqElement.id))\r\n\r\n\t\tstyleFragments.push(JqCSSRule.getStyleFragment(blockStyle))\r\n\t\tattachStylesToStylesheet(jqElement, styleFragments)\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqElement} jqElement \r\n\t * @param {JqEffectNode[]} jqEffectNodes \r\n\t */\r\n\tstatic collectDetachableEffectNodes(jqElement, jqEffectNodes) {\r\n\t\tjqEffectNodes.push(...jqElement.events)\r\n\t\tjqEffectNodes.push(...jqElement.lifecycles)\r\n\t\treturn jqEffectNodes\r\n\t}\r\n}\r\n\r\nconst JqParentable = {\r\n\t/**\r\n\t * @param {JqElement | JqFragment} jqNode\r\n\t * @param {Node | JqElement | JqFragment | null} parentNode\r\n\t * @param {(typeof JqElement.attachNode) | (typeof JqFragment.attachNode)} attachNode\r\n\t * @returns {string}\r\n\t */\r\n\tattachTo(jqNode, parentNode, attachNode, alterDomNode = true) {\r\n\t\tif (parentNode === null) {\r\n\t\t\tattachNode(/**@type {any}*/(jqNode), parentNode, alterDomNode)\r\n\t\t}\r\n\t\telse if (parentNode instanceof HTMLElement) {\r\n\t\t\tattachNode(/**@type {any}*/(jqNode), parentNode, alterDomNode)\r\n\t\t\talterDomNode && parentNode.appendChild(/**@type {HTMLElement}*/(jqNode.domNode))\r\n\t\t}\r\n\t\telse if (parentNode instanceof JqElement) {\r\n\t\t\tjqNode.jqParent = parentNode\r\n\t\t\tjqNode.scopedStyleSheet = parentNode.scopedStyleSheet\r\n\t\t\tattachNode(/**@type {any}*/(jqNode), parentNode, alterDomNode)\r\n\r\n\t\t\tif (!parentNode.childNodes.includes(jqNode)) {\r\n\t\t\t\tparentNode.childNodes.splice(jqNode.nodePosition, 0, jqNode)\r\n\t\t\t}\r\n\r\n\t\t\tconst domNode = parentNode.shadowRoot ?? /**@type {Node}*/ (parentNode.domNode)\r\n\t\t\talterDomNode && domNode.appendChild(/**@type {Node}*/(jqNode.domNode))\r\n\t\t}\r\n\t\telse if (parentNode instanceof JqFragment) {\r\n\t\t\tjqNode.jqParent = parentNode\r\n\t\t\tjqNode.scopedStyleSheet = parentNode.scopedStyleSheet\r\n\t\t\tattachNode(/**@type {any}*/(jqNode), parentNode, alterDomNode)\r\n\r\n\t\t\tif (!parentNode.childNodes.includes(jqNode)) {\r\n\t\t\t\tparentNode.childNodes.splice(jqNode.nodePosition, 0, jqNode)\r\n\t\t\t}\r\n\r\n\t\t\tif (alterDomNode) {\r\n\t\t\t\t/**@type {Node}*/ (parentNode.domNode).appendChild(/**@type {Node}*/(jqNode.domNode))\r\n\t\t\t\tlet ancestor = parentNode.jqParent\r\n\r\n\t\t\t\twhile (ancestor != null && isJqFragment(ancestor)) {\r\n\t\t\t\t\tancestor = ancestor.jqParent\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (ancestor != null) {\r\n\t\t\t\t\t   /**@type {Node}*/ (ancestor.domNode).appendChild(/**@type {Node}*/(jqNode.domNode))\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst errors = (jqNode instanceof JqElement ? JqElement : JqFragment).errors\r\n\t\t\tthrow new Error(errors.invalidAttachTo(/**@type {any}*/(jqNode)))\r\n\t\t}\r\n\r\n\t\tif (alterDomNode) {\r\n\t\t\tfor (let i = 0; i < jqNode.lifecycles.length; i++) {\r\n\t\t\t\tconst lifecycle = jqNode.lifecycles[i]\r\n\t\t\t\tlifecycle.jqParent = jqNode\r\n\r\n\t\t\t\tif (lifecycle.type != OnAttachCallback) continue\r\n\t\t\t\tlifecycle.callback(jqNode)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn jqNode.toString()\r\n\t},\r\n\tinitial: {\r\n\t\t/**\r\n\t\t * @param {JqElement | JqFragment} jqNode\r\n\t\t */\r\n\t\tattachChildren(jqNode, alterDomNode = true) {\r\n\t\t\tconst jqEffectNodes = JqEffectNode.getEffectNodes(jqNode)\r\n\t\t\tconst childNodes = jqNode.childNodes, childCount = childNodes.length\r\n\r\n\t\t\tfor (let i = 0; i < childCount; i++) {\r\n\t\t\t\tconst childNode = childNodes[i]\r\n\t\t\t\tconst precedingEffectNodes = JqEffectNode.getPrecedingEffectNodes(jqEffectNodes, childNode)\r\n\t\t\t\tJqEffectNode.attachEffectNodes(precedingEffectNodes, jqNode, alterDomNode)\r\n\t\t\t\tchildNode.attachTo(jqNode, alterDomNode)\r\n\t\t\t}\r\n\r\n\t\t\tJqEffectNode.attachEffectNodes(jqEffectNodes, jqNode, alterDomNode)\r\n\t\t}\r\n\t},\r\n\tupdate: {\r\n\t\t/**\r\n\t\t * @param {JqElement | JqFragment} jqNode\r\n\t\t * @param {JqElement | JqFragment | JqText} oldChildNode \r\n\t\t * @param {JqElement | JqFragment | JqText} newChildNode\r\n\t\t */\r\n\t\treplaceChild(jqNode, oldChildNode, newChildNode) {\r\n\t\t\tconst delChildIdx = jqNode.childNodes.findIndex(childNode => Object.is(childNode, oldChildNode))\r\n\r\n\t\t\tif (delChildIdx == -1) {\r\n\t\t\t\tconst errors = (jqNode instanceof JqElement ? JqElement : JqFragment).errors\r\n\t\t\t\tthrowError(errors.childNodeNotFound(/**@type {any}*/(jqNode)))\r\n\t\t\t}\r\n\r\n\t\t\tnewChildNode.nodePosition = oldChildNode.nodePosition\r\n\t\t\tnewChildNode.attachTo(jqNode)\r\n\t\t\toldChildNode.delete.deleteSelf()\r\n\t\t}\r\n\t},\r\n\tdelete: {\r\n\t\t/**\r\n\t\t * @param {JqElement | JqFragment} jqNode\r\n\t\t */\r\n\t\tdeleteSelf(jqNode) {\r\n\t\t\tconst { errors, collectDetachableEffectNodes } = JqParentable.getParentableClass(jqNode)\r\n\t\t\tconst jqParent = /**@type {JqElement | JqFragment}*/ (jqNode.jqParent)\r\n\r\n\t\t\tconst delChildIdx = jqParent.childNodes.findIndex(childNode => Object.is(childNode, jqNode))\r\n\t\t\tif (delChildIdx == -1) throwError(errors.invalidParent(/**@type {any}*/(jqNode)))\r\n\r\n\t\t\tfor (let i = 0; i < jqNode.lifecycles.length; i++) {\r\n\t\t\t\tconst lifecycle = jqNode.lifecycles[i]\r\n\t\t\t\tif (lifecycle.type != OnDetachCallback) continue\r\n\r\n\t\t\t\tlifecycle.callback(jqNode)\r\n\t\t\t}\r\n\r\n\t\t\tjqParent.childNodes.splice(delChildIdx, 1)\r\n\t\t\twhile (jqNode.childNodes.length) {\r\n\t\t\t\tconst childNode = jqNode.childNodes[0]\r\n\t\t\t\tchildNode.delete.deleteSelf()\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * @type {JqEffectNode[]}\r\n\t\t\t */\r\n\t\t\tconst jqEffectNodes = JqEffectNode.getEffectNodes(jqNode)\r\n\t\t\tcollectDetachableEffectNodes(/**@type {any}*/(jqNode), jqEffectNodes)\r\n\r\n\t\t\tfor (const jqEffectNode of jqEffectNodes) {\r\n\t\t\t\tjqEffectNode.delete.deleteSelf()\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t/**\r\n\t * @param {JqElement | JqFragment} jqNode\r\n\t */\r\n\tgetParentableClass(jqNode) {\r\n\t\tif (jqNode instanceof JqElement) return JqElement\r\n\t\tif (jqNode instanceof JqFragment) return JqFragment\r\n\r\n\t\tthrow new Error(\"JqInternalError - Expected an instance of JqElement | JqFragment as the first argument\")\r\n\t}\r\n}\r\n\r\nconst JqEffectNode = {\r\n\tdelete: {\r\n\t\t/**\r\n\t\t * @param {JqEffectNode} jqEffectNode\r\n\t\t */\r\n\t\tdeleteSelf(jqEffectNode) {\r\n\t\t\tconst jqParent = /**@type {JqElement | JqFragment}*/ (jqEffectNode.jqParent)\r\n\r\n\t\t\tconst { errors, getInstancesFromParent } = JqEffectNode.getEffectClass(jqEffectNode)\r\n\t\t\tconst similarEffectInstances = getInstancesFromParent(jqParent)\r\n\r\n\t\t\tconst delNodeIdx = similarEffectInstances.findIndex(instance => Object.is(instance, jqEffectNode))\r\n\t\t\tif (delNodeIdx == -1) throwError(errors.invalidParent(/**@type {any}*/(jqEffectNode)))\r\n\r\n\t\t\tsimilarEffectInstances.splice(delNodeIdx, 1)\r\n\t\t}\r\n\t},\r\n\t/**\r\n\t * @param {JqEffectNode} effectNode\r\n\t */\r\n\tgetEffectClass(effectNode) {\r\n\t\tif (effectNode instanceof JqEach) return JqEach\r\n\t\tif (effectNode instanceof JqCondition) return JqCondition\r\n\t\tif (effectNode instanceof JqEvent) return JqEvent\r\n\t\tif (effectNode instanceof JqWatch) return JqWatch\r\n\r\n\t\tthrow new Error(\"JqInternalError - Expected an instance of JqEffectNode as the first argument\")\r\n\t},\r\n\t/**\r\n\t * @param {JqNode} jqNode\r\n\t */\r\n\tisInvokableEffectNode: (jqNode) => jqNode instanceof JqEach\r\n\t\t|| jqNode instanceof JqCondition\r\n\t\t|| jqNode instanceof JqWatch,\r\n\r\n\t/**\r\n\t* @param {Array<JqWatch | JqCondition | JqEach<any>>} effectNodes\r\n\t* @param {JqElement | JqFragment} jqNode\r\n\t* @param {boolean} alterDomNode\r\n\t*/\r\n\tattachEffectNodes(effectNodes, jqNode, alterDomNode) {\r\n\t\tfor (const effectNode of effectNodes) {\r\n\t\t\teffectNode.jqParent = jqNode\r\n\t\t\tconst returned = effectNode.returned\r\n\r\n\t\t\tif (effectNode.jqParent.childNodes.includes(/**@type {any}*/(returned))) continue\r\n\t\t\tconst childNode = JqEffectNode.extractEffectReturn(effectNode, jqNode)\r\n\t\t\teffectNode.returned = childNode\r\n\r\n\t\t\tif (effectNode instanceof JqWatch) {\r\n\t\t\t\tfor (const _jqState of effectNode.jqStates) {\r\n\t\t\t\t\tconst jqState = /**@type {JqState}*/ (_jqState[JqNodeReference])\r\n\t\t\t\t\tconst watcherIdx = jqState.watchers\r\n\t\t\t\t\t\t.findIndex(watcher => watcher.callback.toString() == effectNode.callback.toString())\r\n\r\n\t\t\t\t\tif (watcherIdx == -1) {\r\n\t\t\t\t\t\tjqState.watchers.push(effectNode)\r\n\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tjqState.watchers.splice(watcherIdx, 1, effectNode)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tchildNode.attachTo(jqNode, alterDomNode)\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t* @param {Exclude<JqEffectNode, JqEvent | JqLifecycle>[]} jqEffectNodes\r\n\t* @param {JqElement | JqFragment | JqText} jqNode\r\n\t*/\r\n\tgetPrecedingEffectNodes(jqEffectNodes, jqNode) {\r\n\t\t/**\r\n\t\t * @type {Exclude<JqEffectNode, JqEvent | JqLifecycle>[]}\r\n\t\t */\r\n\t\tconst precedingJqEffectNodes = []\r\n\t\tfor (let i = 0; i < jqEffectNodes.length; i++) {\r\n\t\t\tconst jqEffectNode = jqEffectNodes[i]\r\n\t\t\tconst effectNodePos = jqEffectNode.nodePosition\r\n\r\n\t\t\tif (effectNodePos > jqNode.nodePosition) continue\r\n\r\n\t\t\tjqEffectNodes.splice(effectNodePos, 1)\r\n\t\t\tprecedingJqEffectNodes.push(jqEffectNode)\r\n\t\t}\r\n\t\treturn precedingJqEffectNodes\r\n\t},\r\n\r\n\t/**\r\n\t* @param {JqElement | JqFragment} jqNode\r\n\t*/\r\n\tgetEffectNodes(jqNode) {\r\n\t\t/**\r\n\t\t * @type {Exclude<JqEffectNode, JqEvent | JqLifecycle>[]}\r\n\t\t */\r\n\t\tconst jqEffectNodes = []\r\n\t\tconst maxLength = Math.max(\r\n\t\t\tjqNode.watchers.length,\r\n\t\t\tjqNode.conditions.length,\r\n\t\t\tjqNode.iterators.length\r\n\t\t)\r\n\r\n\t\tfor (let i = 0; i < maxLength; i++) {\r\n\t\t\tconst _jqEffectNodes = [\r\n\t\t\t\tjqNode.watchers[i],\r\n\t\t\t\tjqNode.conditions[i],\r\n\t\t\t\tjqNode.iterators[i]\r\n\t\t\t].filter(Boolean)\r\n\r\n\t\t\tjqEffectNodes.push(..._jqEffectNodes)\r\n\t\t}\r\n\r\n\t\treturn jqEffectNodes\r\n\t},\r\n\r\n\t/**\r\n\t* @param {Exclude<JqEffectNode, JqEvent | JqLifecycle>} effectNode \r\n\t* @param {JqElement | JqFragment | null} jqParent \r\n\t* @returns \r\n\t*/\r\n\textractEffectReturn(effectNode, jqParent) {\r\n\t\tlet jqNode = effectNode.invoke()\r\n\r\n\t\twhile (JqEffectNode.isInvokableEffectNode(jqNode) || typeof jqNode == \"function\") {\r\n\t\t\tjqNode = convertToJqNode(jqNode, jqParent)\r\n\t\t\tjqNode = /**@type {JqEach<any> | JqCondition | JqWatch}*/ (jqNode).invoke()\r\n\t\t}\r\n\r\n\t\tconst childNode = /**@type {JqText | JqFragment | JqElement}*/ (convertToJqNode(jqNode, jqParent))\r\n\t\tchildNode.nodePosition = effectNode.nodePosition\r\n\r\n\t\treturn childNode\r\n\t}\r\n}\r\n\r\nconst JqStyleNode = {\r\n\t/**\r\n\t * @param {JqCSSProperty | JqCSSRule} styleNode\r\n\t */\r\n\tgetStyleClass(styleNode) {\r\n\t\tif (styleNode instanceof JqCSSProperty) return JqCSSProperty\r\n\t\tif (styleNode instanceof JqCSSRule) return JqCSSRule\r\n\r\n\t\tthrow new Error(\"JqInternalError - Expected an instance of JqStyleNode as the first argument\")\r\n\t},\r\n\t/**\r\n\t * @param {JqElement} jqElement\r\n\t * @param {JqFragment[]} styleFragments\r\n\t */\r\n\tattachStylesToStylesheet(jqElement, styleFragments) {\r\n\t\tconst jqStyleElement = jqElement.scopedStyleSheet\r\n\r\n\t\tstyleFragments.forEach(x => x.attachTo(jqStyleElement))\r\n\t\treturn jqStyleElement// 849, 71, -4414\r\n\t},\r\n\t/**\r\n\t * @param {JqElement} jqElement\r\n\t * @param {JqElement | JqFragment | HTMLElement | null} parentNode\r\n\t * @param {boolean} isNonStylable \r\n\t */\r\n\tmaybeAttachStyleElementToHTMLParent(jqElement, parentNode, isNonStylable) {\r\n\t\tif (!(parentNode instanceof HTMLElement) || isNonStylable) return\r\n\t\tconst jqStyleElement = new JqElement(\"style\", /**@type {any}*/({}))\r\n\t\tjqStyleElement.attachTo(parentNode)\r\n\r\n\t\tjqElement.scopedStyleSheet = jqStyleElement\r\n\t},\r\n\t/**\r\n\t * @param {JqCSSRule} jqCSSRule\r\n\t * @param {string} hash\r\n\t */\r\n\tformatSelectorAndGetStyleFragment(jqCSSRule, hash) {\r\n\t\tjqCSSRule.head[0] = JqStyleNode.formatSelector(hash, jqCSSRule.head[0])\r\n\t\treturn JqCSSRule.getStyleFragment(jqCSSRule)\r\n\t},\r\n\t/**\r\n\t * @param {string} hash\r\n\t * @param {string} selector\r\n\t */\r\n\tformatSelector(hash, selector) {\r\n\t\tconst hashCls = '.' + hash\r\n\r\n\t\tif (selector == \":JqCSSRule\") return hashCls\r\n\t\tif (selector.startsWith('@')) return selector\r\n\t\tif(selector.startsWith(\"::\")) return `${hashCls}${selector}`\r\n\r\n\t\treturn `${hashCls} :where(${selector})`\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {HTMLElement} element \r\n * @param {ResolveFn} callback\r\n */\r\nexport function observeElement(element, callback) {\r\n\r\n\t/**\r\n\t * @param {ResolveFn} callback \r\n\t * @returns {IntersectionObserverCallback}\r\n\t */\r\n\tconst observerCallback =\r\n\t\tcallback => (entries, observer) =>\r\n\t\t\tentries.forEach(entry => callback([entry, observer]))\r\n\r\n\treturn new IntersectionObserver(observerCallback(callback)).observe(element)\r\n}\r\n\r\n/**\r\n * @param {HTMLElement} element\r\n */\r\nexport function canHaveShadow(element) {\r\n\ttry {\r\n\t\treturn Boolean(/**@type {HTMLElement}*/(element.cloneNode()).attachShadow({ mode: \"open\" }))\r\n\t} catch {\r\n\t\treturn false\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {string} str\r\n */\r\nexport const camelToKebab = (str) =>\r\n\tstr.replace(/[A-Z]+(?![a-z])|[A-Z]/g, ($, ofs) => (ofs ? \"-\" : \"\") + $.toLowerCase())\r\n\r\n/**\r\n * @param {string} errorMessage \r\n * @param {{ [x: string]: Primitive }} styleObject\r\n */\r\nexport function createPropertyListFromStyleObject(errorMessage, styleObject) {\r\n\t/**\r\n\t * @param {any} value\r\n\t */\r\n\tconst isObject = (value) => value !== null && typeof value == \"object\"\r\n\tif (!isObject(styleObject)) throwError(errorMessage)\r\n\r\n\t/**\r\n\t * @type {JqCSSProperty[]}\r\n\t */\r\n\tconst styleProperties = Object.entries(styleObject)\r\n\t\t.map(([key, value]) => new JqCSSProperty(key, value))\r\n\r\n\treturn new JqList(JqCSSProperty, styleProperties)\r\n}\r\n\r\n/**\r\n * @template {string} T\r\n * @param {HexColor<T>} col\r\n * @param {number} amt\r\n */\r\nexport function adjustColor(col, amt) {\r\n\r\n\tlet usePound = false\r\n\r\n\tif (col[0] == '#') {\r\n\t\tcol = /**@type {HexColor<T>}*/ (/**@type {string}*/ (col).slice(1))\r\n\t\tusePound = true\r\n\t}\r\n\r\n\tconst num = parseInt(col, 16)\r\n\r\n\tlet r = (num >> 16) + amt\r\n\r\n\tif (r > 255) r = 255\r\n\telse if (r < 0) r = 0\r\n\r\n\tlet b = ((num >> 8) & 0x00FF) + amt\r\n\r\n\tif (b > 255) b = 255\r\n\telse if (b < 0) b = 0\r\n\r\n\tlet g = (num & 0x0000FF) + amt\r\n\r\n\tif (g > 255) g = 255\r\n\telse if (g < 0) g = 0\r\n\r\n\treturn (usePound ? '#' : '') + (g | (b << 8) | (r << 16)).toString(16)\r\n}\r\n\r\n/**\r\n * @param {JqNode} node1 \r\n * @param {JqNode} node2\r\n */\r\nfunction diff(node1, node2) {\r\n\tconst nodeComparison = compareJqNodes(node1, node2)\r\n\treturn nodeComparison\r\n\r\n\t/**\r\n\t * @param {CompareProps} affected1 \r\n\t * @param {CompareProps} affected2\r\n\t */\r\n\tfunction compareProps(affected1, affected2) {\r\n\t\t/**\r\n\t\t * @type {Diff}\r\n\t\t */\r\n\t\tconst diff = {\r\n\t\t\ttype: Object.getPrototypeOf(affected1.object).constructor,\r\n\t\t\tnode1: affected1.object,\r\n\t\t\tnode2: affected2.object,\r\n\t\t\t[CREATED]: [],\r\n\t\t\t[UPDATED]: [],\r\n\t\t\t[DELETED]: [],\r\n\t\t\t[UNCHANGED]: [],\r\n\t\t\tchildDiffs: [],\r\n\t\t}\r\n\r\n\t\tconst deletedProps = affected1.props.filter(prop =>\r\n\t\t\tisNullish(getPropertyValue(/**@type {any}*/(affected2.object), prop)))\r\n\r\n\t\tdiff[DELETED] = /**@type {any}*/ (deletedProps)\r\n\r\n\t\tconst createdProps = affected2.props.filter(prop =>\r\n\t\t\tisNullish(getPropertyValue(/**@type {any}*/(affected1.object), prop)))\r\n\r\n\t\tdiff[CREATED] = /**@type {any}*/ (createdProps)\r\n\r\n\t\tconst updatedProps = affected1.props.filter(prop =>\r\n\t\t\tgetPropertyValue(/**@type {any}*/(affected2.object), prop) !==\r\n\t\t\tgetPropertyValue(/**@type {any}*/(affected1.object), prop))\r\n\r\n\t\tdiff[UPDATED] = /**@type {any}*/ (updatedProps)\r\n\r\n\t\tconst unchangedProps = affected1.props.filter(prop =>\r\n\t\t\tgetPropertyValue(/**@type {any}*/(affected2.object), prop) ===\r\n\t\t\tgetPropertyValue(/**@type {any}*/(affected1.object), prop))\r\n\r\n\t\tdiff[UNCHANGED] = /**@type {any}*/ (unchangedProps)\r\n\r\n\t\treturn diff\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqText} node1 \r\n\t * @param {JqText} node2\r\n\t */\r\n\tfunction compareJqTexts(node1, node2) {\r\n\t\tconst affected1 = {\r\n\t\t\tobject: node1,\r\n\t\t\tprops: [[\"text\"]]\r\n\t\t}\r\n\r\n\t\tconst affected2 = {\r\n\t\t\tobject: node2,\r\n\t\t\tprops: [[\"text\"]]\r\n\t\t}\r\n\r\n\t\tconst diff = compareProps(affected1, affected2)\r\n\t\treturn diff\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqAttribute} jqAttribute1 \r\n\t * @param {JqAttribute} jqAttribute2\r\n\t */\r\n\tfunction compareJqAttributes(jqAttribute1, jqAttribute2) {\r\n\t\tconst affected1 = {\r\n\t\t\tobject: jqAttribute1,\r\n\t\t\tprops: [[\"name\"], [\"value\"]]\r\n\t\t}\r\n\r\n\t\tconst affected2 = {\r\n\t\t\tobject: jqAttribute2,\r\n\t\t\tprops: [[\"name\"], [\"value\"]]\r\n\t\t}\r\n\r\n\t\tconst diff = compareProps(affected1, affected2)\r\n\t\treturn diff\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqFragment} node1 \r\n\t * @param {JqFragment} node2\r\n\t */\r\n\tfunction compareJqFragments(node1, node2) {\r\n\t\tconst firstFragChildren = node1.childNodes\r\n\t\tconst secondFragChildren = node2.childNodes\r\n\r\n\t\t/**\r\n\t\t * @type {Diff}\r\n\t\t */\r\n\t\tconst _diff = {\r\n\t\t\ttype: Object.getPrototypeOf(node1).constructor,\r\n\t\t\tnode1: node1,\r\n\t\t\tnode2: node2,\r\n\t\t\t[CREATED]: [],\r\n\t\t\t[UPDATED]: [],\r\n\t\t\t[DELETED]: [],\r\n\t\t\t[UNCHANGED]: [],\r\n\t\t\tchildDiffs: [],\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < Math.max(firstFragChildren.length, secondFragChildren.length); i++) {\r\n\t\t\tconst firstFragChild = firstFragChildren[i]\r\n\t\t\tconst secondFragChild = secondFragChildren[i]\r\n\r\n\t\t\tif (firstFragChild === undefined)\r\n\t\t\t\t_diff[CREATED].push([\"childNodes\", secondFragChild])\r\n\t\t\telse if (secondFragChild === undefined)\r\n\t\t\t\t_diff[DELETED].push([\"childNodes\", firstFragChild])\r\n\t\t\telse\r\n\t\t\t\t_diff.childDiffs.push(diff(firstFragChild, secondFragChild))\r\n\t\t}\r\n\r\n\t\treturn _diff\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqElement} node1 \r\n\t * @param {JqElement} node2\r\n\t */\r\n\tfunction compareJqElements(node1, node2) {\r\n\t\tconst firstElemChildren = node1.childNodes\r\n\t\tconst secondElemChildren = node2.childNodes\r\n\r\n\t\tconst firstElemAttributes = node1.attributes\r\n\t\tconst secondElemAttributes = node2.attributes\r\n\r\n\t\t/**\r\n\t\t * @type {Diff}\r\n\t\t */\r\n\t\tconst _diff = {\r\n\t\t\ttype: Object.getPrototypeOf(node1).constructor,\r\n\t\t\tnode1: node1,\r\n\t\t\tnode2: node2,\r\n\t\t\t[CREATED]: [],\r\n\t\t\t[UPDATED]: [],\r\n\t\t\t[DELETED]: [],\r\n\t\t\t[UNCHANGED]: [],\r\n\t\t\tchildDiffs: [],\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < Math.max(firstElemChildren.length, secondElemChildren.length); i++) {\r\n\t\t\tconst firstElemChild = firstElemChildren[i]\r\n\t\t\tconst secondElemChild = secondElemChildren[i]\r\n\r\n\t\t\tif (firstElemChild === undefined)\r\n\t\t\t\t_diff[CREATED].push([\"childNodes\", secondElemChild])\r\n\t\t\telse if (secondElemChild === undefined)\r\n\t\t\t\t_diff[DELETED].push([\"childNodes\", firstElemChild])\r\n\t\t\telse\r\n\t\t\t\t_diff.childDiffs.push(diff(firstElemChild, secondElemChild))\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < Math.max(firstElemAttributes.length, secondElemAttributes.length); i++) {\r\n\t\t\tconst firstElemAttribute = firstElemAttributes[i]\r\n\t\t\tconst secondElemAttribute = secondElemAttributes[i]\r\n\r\n\t\t\tif (firstElemAttribute === undefined)\r\n\t\t\t\t_diff[CREATED].push([\"attributes\", secondElemAttribute])\r\n\t\t\telse if (secondElemAttribute === undefined)\r\n\t\t\t\t_diff[DELETED].push([\"attributes\", firstElemAttribute])\r\n\t\t\telse\r\n\t\t\t\t_diff.childDiffs.push(diff(firstElemAttribute, secondElemAttribute))\r\n\t\t}\r\n\r\n\t\treturn _diff\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqNode} node1 \r\n\t * @param {JqNode} node2\r\n\t */\r\n\tfunction compareJqNodes(node1, node2) {\r\n\t\tif (isJqElement(node1) && isJqElement(node2))\r\n\t\t\treturn compareJqElements(/**@type {JqElement}*/(node1), /**@type {JqElement}*/(node2))\r\n\t\tif (isJqFragment(node1) && isJqFragment(node2))\r\n\t\t\treturn compareJqFragments(/**@type {JqFragment}*/(node1), /**@type {JqFragment}*/(node2))\r\n\t\tif (isJqAttribute(node1) && isJqAttribute(node2))\r\n\t\t\treturn compareJqAttributes(/**@type {JqAttribute}*/(node1), /**@type {JqAttribute}*/(node2))\r\n\t\tif (isJqText(node1) && isJqText(node2))\r\n\t\t\treturn compareJqTexts(/**@type {JqText}*/(node1), /**@type {JqText}*/(node2))\r\n\r\n\t\treturn compareJqGenericNodes(node1, node2)\r\n\t}\r\n\r\n\t/**\r\n\t * @param {JqNode} [node1] \r\n\t * @param {JqNode} [node2]\r\n\t */\r\n\tfunction compareJqGenericNodes(node1, node2) {\r\n\t\t/**\r\n\t\t * @type {Diff}\r\n\t\t */\r\n\t\tconst _diff = {\r\n\t\t\ttype: Object.getPrototypeOf(node1).constructor,\r\n\t\t\tnode1: /**@type {JqNode}*/ (node1),\r\n\t\t\tnode2: /**@type {JqNode}*/ (node2),\r\n\t\t\t[CREATED]: [],\r\n\t\t\t[UPDATED]: [],\r\n\t\t\t[DELETED]: [],\r\n\t\t\t[UNCHANGED]: [],\r\n\t\t\tchildDiffs: [],\r\n\t\t}\r\n\r\n\t\tconst [isNode1, isNode2] = [isNullish(node1), isNullish(node2)]\r\n\r\n\t\tif (isNode1)\r\n\t\t\t_diff[CREATED].push([\"self\"])\r\n\t\tif (isNode2)\r\n\t\t\t_diff[DELETED].push([\"self\"])\r\n\t\tif (isNode1 || isNode2) return _diff\r\n\r\n\t\tconst jqParent = /**@type {JqElement | JqFragment}*/ (/**@type {JqElement | JqFragment}*/(node1).jqParent)\r\n\t\t_diff[UPDATED].push([\"childNodes\", /**@type {JqNode}*/ (node2)])\r\n\r\n\t\treturn _diff\r\n\t}\r\n}\r\n\r\nexport const validHTMLElements = /**@type {const}*/ ([\r\n\t\"a\",\r\n\t\"address\",\r\n\t\"article\",\r\n\t\"aside\",\r\n\t\"audio\",\r\n\t\"b\",\r\n\t\"base\",\r\n\t\"bdo\",\r\n\t\"br\",\r\n\t\"button\",\r\n\t\"canvas\",\r\n\t\"caption\",\r\n\t\"cite\",\r\n\t\"code\",\r\n\t\"col\",\r\n\t\"colgroup\",\r\n\t\"command\",\r\n\t\"data\",\r\n\t\"datalist\",\r\n\t\"dd\",\r\n\t\"del\",\r\n\t\"details\",\r\n\t\"dfn\",\r\n\t\"dialog\",\r\n\t\"div\",\r\n\t\"dl\",\r\n\t\"dt\",\r\n\t\"em\",\r\n\t\"embed\",\r\n\t\"fieldset\",\r\n\t\"figure\",\r\n\t\"figcaption\",\r\n\t\"footer\",\r\n\t\"form\",\r\n\t\"h1\",\r\n\t\"h2\",\r\n\t\"h3\",\r\n\t\"h4\",\r\n\t\"h5\",\r\n\t\"h6\",\r\n\t\"head\",\r\n\t\"header\",\r\n\t\"hgroup\",\r\n\t\"hr\",\r\n\t\"html\",\r\n\t\"i\",\r\n\t\"img\",\r\n\t\"input\",\r\n\t\"ins\",\r\n\t\"kbd\",\r\n\t\"label\",\r\n\t\"legend\",\r\n\t\"li\",\r\n\t\"link\",\r\n\t\"main\",\r\n\t\"map\",\r\n\t\"mark\",\r\n\t\"math\",\r\n\t\"meter\",\r\n\t\"nav\",\r\n\t\"noscript\",\r\n\t\"object\",\r\n\t\"ol\",\r\n\t\"optgroup\",\r\n\t\"option\",\r\n\t\"output\",\r\n\t\"p\",\r\n\t\"param\",\r\n\t\"pre\",\r\n\t\"progress\",\r\n\t\"portal\",\r\n\t\"q\",\r\n\t\"ruby\",\r\n\t\"s\",\r\n\t\"section\",\r\n\t\"small\",\r\n\t\"span\",\r\n\t\"strike\",\r\n\t\"tt\",\r\n\t\"u\",\r\n\t\"var\",\r\n\t\"video\",\r\n\t\"wbr\",\r\n\t\"abbr\",\r\n\t\"area\",\r\n\t\"bdi\",\r\n\t\"blockquote\",\r\n\t\"body\",\r\n\t\"iframe\",\r\n\t\"menu\",\r\n\t\"meta\",\r\n\t\"picture\",\r\n\t\"rb\",\r\n\t\"rp\",\r\n\t\"rt\",\r\n\t\"rtc\",\r\n\t\"samp\",\r\n\t\"script\",\r\n\t\"select\",\r\n\t\"slot\",\r\n\t\"source\",\r\n\t\"strong\",\r\n\t\"style\",\r\n\t\"sub\",\r\n\t\"summary\",\r\n\t\"sup\",\r\n\t\"table\",\r\n\t\"tbody\",\r\n\t\"td\",\r\n\t\"template\",\r\n\t\"textarea\",\r\n\t\"tfoot\",\r\n\t\"th\",\r\n\t\"thead\",\r\n\t\"time\",\r\n\t\"title\",\r\n\t\"tr\",\r\n\t\"track\",\r\n\t\"ul\",\r\n])\r\n\r\n/**\r\n * @typedef {null | undefined | boolean | number | string | symbol | bigint} Primitive\r\n * \r\n * @typedef {{ [styleName: string]: Primitive | Primitive[] }\r\n * | Map<string, Primitive>\r\n * | Array<{ [styleName: string]: Primitive | Primitive[] } | Map<string, Primitive>>} AnimationStyles\r\n * \r\n * @typedef {{\r\n *    duration?: string | number,\r\n *    easing?: string,\r\n *    complete?: (..._: unknown[]) => unknown,\r\n *    step?: (..._: unknown[]) => unknown,\r\n *    progress?: (..._: unknown[]) => unknown,\r\n *    specialEasing?: AnimationStyles,\r\n *    start?: (..._: unknown[]) => unknown,\r\n *    done?: (..._: unknown[]) => unknown,\r\n *    fail?: (..._: unknown[]) => unknown,\r\n *    always?: (..._: unknown[]) => unknown\r\n * }} AnimationOptions\r\n * \r\n * @typedef {(styles: AnimationStyles, ...options: ([speed?: number | \"fast\" | \"slow\", easing?: string, callback?: (..._: unknown[]) => unknown]) | [option: AnimationOptions]) => Animation} AnimateFn\r\n * \r\n * @typedef {(arg0: [IntersectionObserverEntry, IntersectionObserver]) => unknown} ResolveFn\r\n * \r\n * @typedef {(reason?: unknown) => unknown} RejectFn\r\n * \r\n * @typedef {{\r\n *    type: new (...a: any) => JqNode,\r\n *    node1: JqNode,\r\n *    node2: JqNode,\r\n *    [UPDATED]: [string, ...Array<string | JqNode>][],\r\n *    [DELETED]: [string, ...Array<string | JqNode>][],\r\n *    [CREATED]: [string, ...Array<string | JqNode>][],\r\n *    [UNCHANGED]: [string, ...Array<string | JqNode>][],\r\n *    childDiffs: Diff[]\r\n * }} Diff\r\n * \r\n * @typedef {JqElement | JqAttribute | JqCSSProperty | JqCSSRule | JqAnimation | JqEvent | JqState | JqFragment | JqText | JqWatch | JqCondition | JqEach<any> | JqLifecycle | JqPromise<any>} JqNode\r\n * \r\n * @typedef {'0' | '1' | '2' | '3' | '4' | '5' | '6' | '7' | '8' | '9' | 'a' | 'b' | 'c' | 'd' | 'e' | 'f' | 'A' | 'B' | 'C' | 'D' | 'E' | 'F'} HexDigit\r\n * \r\n * @typedef {{\r\n *    childNodes: Array<JqElement | JqFragment | JqText>,\r\n *    attributes: JqAttribute[], events: JqEvent[],\r\n *    animations: JqAnimation[], inlineStyles: Array<JqCSSProperty>, blockStyles: Array<JqCSSRule>,\r\n *    watchers: JqWatch[], conditions: JqCondition[], iterators: JqEach<any>[], domNode?: HTMLElement\r\n * }} JqElementParameters\r\n * \r\n * @typedef {JqText | JqAttribute | JqElement | JqFragment} DiffableJqNode\r\n * \r\n * @typedef {JqList<JqState, typeof JqState> | JqEach<any> | JqEvent | JqCondition | Event | boolean | [any, number, Iterable<any>]} CallbackArg\r\n * \r\n * @typedef {{ object: JqNode, props: string[][] }} CompareProps\r\n * \r\n * @typedef {JqWatch | JqEvent | JqCondition | JqEach<any> | JqLifecycle} JqEffectNode\r\n */\r\n\r\n/**\r\n * @template T\r\n * @typedef {{\r\n *    pending: Array<{\r\n *       subscriber: JqElement | JqFragment,\r\n *       callback: (x: Promise<T>) => any,\r\n *    }>,\r\n *    resolved: Array<{\r\n *       subscriber: JqElement | JqFragment,\r\n *       callback: (x: T) => any,\r\n *    }>,\r\n *    rejected: Array<{\r\n *       subscriber: JqElement | JqFragment,\r\n *       callback: (x: any) => any,\r\n *    }>\r\n * }} JqPromiseSubscription\r\n */\r\n\r\n/**\r\n * @template {string} T\r\n * @typedef { T extends `#${HexDigit}${HexDigit}${HexDigit}${infer Rest1}`\r\n *    ? (\r\n *       Rest1 extends ``\r\n *          ? T\r\n *          : (\r\n *             Rest1 extends `${HexDigit}${HexDigit}${HexDigit}`\r\n *                ? T\r\n *                : never\r\n *           )\r\n *      )\r\n *    : never\r\n * } HexColor\r\n */","import {\r\n\tJqEvent, JqEach, getNodes, JqAnimation, isPrimitive, JqState, JqElement,\r\n\tJqCSSProperty, JqFragment, JqText, JqCSSRule, JqList,\r\n\tJqAttribute, StateReference, JqNodeReference, validHTMLElements,\r\n\tcamelToKebab, JqCondition, JqLifecycle, JqPromise, JqWatch, OnAttachCallback, OnDetachCallback,\r\n} from \"./utility.js\"\r\n\r\n/**\r\n * @type {WeakMap<HTMLElement, HTMLStyleElement>}\r\n */\r\nconst scopedStyleSheets = new WeakMap()\r\nconst CustomElements = Symbol(\"CustomElements\")\r\n\r\n/**\r\n * @type {Natives}\r\n */\r\nexport const natives = new Proxy(/** @type {Natives & {[k: string | symbol]: any}} */({}), {\r\n\t/**\r\n\t * @param {string | symbol} prop\r\n\t * @returns {unknown | typeof globalize | ((...nodes: JqNode[]) => JqElement)}\r\n\t */\r\n\tget(target, prop) {\r\n\t\tif (typeof prop == \"symbol\")\r\n\t\t\treturn target[prop]\r\n\r\n\t\tif (prop == \"globalize\")\r\n\t\t\treturn globalize\r\n\r\n\t\treturn (/** @type {import(\"./utility.js\").JqNode[]} */...nodes) => new JqElement(prop, getNodes(nodes))\r\n\t}\r\n})\r\n\r\n/**\r\n * @param {{[k: string | symbol]: any}} [_globalThis] \r\n */\r\nfunction globalize(_globalThis) {\r\n\tvalidHTMLElements\r\n\t\t// @ts-ignore\r\n\t\t.forEach(element => (_globalThis ?? globalThis)[element] = natives[element])\r\n}\r\n\r\n/**\r\n * @type {(strs: string[] | string, ...values: unknown[]) => JqText}\r\n */\r\nconst text = new Proxy(_text, {})\r\n\r\nconst attr = /**@type {AttrFn & AttrProps}*/ (new Proxy(_attr, {\r\n\t/**\r\n\t * @param {string | symbol} prop \r\n\t * @returns {(value: unknown) => JqAttribute}\r\n\t */\r\n\tget(target, prop) {\r\n\t\tif (typeof prop == \"symbol\")\r\n\t\t\treturn target[/**@type {keyof typeof target}*/ (prop)]\r\n\r\n\t\treturn (value) => createAttribute(prop, value)\r\n\t}\r\n}))\r\n\r\nexport const on = /**@type {OnFn & OnProps}*/ (new Proxy(_on, {\r\n\t/**\r\n\t * @param {string | symbol} prop \r\n\t * @returns {(handler: (event?: Event, ...a: unknown[]) => unknown) => JqEvent}\r\n\t */\r\n\tget(target, prop) {\r\n\t\tif (typeof prop == \"symbol\")\r\n\t\t\treturn target[/**@type {keyof typeof target}*/ (prop)]\r\n\r\n\t\treturn (handler) => new JqEvent(prop, handler)\r\n\t}\r\n}))\r\n\r\nexport const css = /**@type {CSSFn & CSSProps}*/ (new Proxy(_css, {\r\n\t/**\r\n\t * @param {string | symbol} prop \r\n\t * @returns {(value: import(\"./utility.js\").Primitive) => JqCSSProperty}\r\n\t */\r\n\tget(target, prop) {\r\n\t\tif (typeof prop == \"symbol\")\r\n\t\t\treturn target[/**@type {keyof typeof target}*/ (prop)]\r\n\r\n\t\treturn (value) => {\r\n\t\t\tconst jqCSSProperty = new JqCSSProperty(prop, value)\r\n\t\t\treturn jqCSSProperty\r\n\t\t}\r\n\t}\r\n}))\r\n\r\n/**\r\n * @param {string} name \r\n * @param {typeof HTMLElement} parent\r\n * @returns {(...nodes: import(\"./utility.js\").JqNode[]) => JqElement}\r\n */\r\nconst customizer = (name, parent = HTMLElement) => {\r\n\tif (customElements.get(name))\r\n\t\tthrow new TypeError(`JqError - custom element '${name}' was already defined`);\r\n\r\n\t_custom[CustomElements].push(name)\r\n\tconst _JqElement = Symbol(\"_JqElement\")\r\n\r\n\tconst node = class extends parent {\r\n\t\t/**\r\n\t\t * @type {JqElement | null}\r\n\t\t */\r\n\t\tstatic [_JqElement] = null\r\n\t\t/**\r\n\t\t * @param {string} name \r\n\t\t * @param {import(\"./utility.js\").JqNode[]} nodes \r\n\t\t */\r\n\t\tconstructor(name, nodes) {\r\n\t\t\tsuper()\r\n\t\t\tnode[_JqElement] = JqElement.custom(this, name, getNodes(nodes))\r\n\t\t}\r\n\t}\r\n\r\n\tcustomElements.define(name, node)\r\n\treturn (...nodes) => /**@type {JqElement}*/(new node(name, nodes), node[_JqElement])\r\n}\r\n\r\nconst _custom = Object.assign(customizer, { [CustomElements]: /** @type {string[]} */ ([]) })\r\n\r\n/**\r\n * @type {Customs} custom\r\n*/\r\nexport const custom = new Proxy(_custom, {\r\n\t/**\r\n\t * @param {string | symbol} prop\r\n\t */\r\n\tget(target, prop) {\r\n\t\tif (typeof prop == \"symbol\")\r\n\t\t\treturn target[/**@type {keyof typeof target}*/ (prop)]\r\n\r\n\t\treturn target(camelToKebab(prop))\r\n\t}\r\n})\r\n\r\n/**\r\n * @param {string} name \r\n * @param {unknown} value \r\n * @returns {JqAttribute}\r\n */\r\nfunction createAttribute(name, value) {\r\n\tconst _value = String(value ?? '')\r\n\treturn new JqAttribute(name, _value)\r\n}\r\n\r\n/**\r\n * @param {{ [x: string]: import(\"./utility.js\").Primitive }} attrObj \r\n * @returns {JqList<JqAttribute, typeof JqAttribute>}\r\n */\r\nfunction _attr(attrObj) {\r\n\tconst attrList = JqAttribute.objectToJqAttributes(attrObj)\r\n\treturn attrList\r\n}\r\n\r\n/**\r\n * @param {unknown} value \r\n * @returns {JqText}\r\n */\r\nfunction createTextNode(value) {\r\n\tconst text = String(value ?? '')\r\n\treturn new JqText(text)\r\n}\r\n\r\n/**\r\n * @param {string[] | string} strs \r\n * @param  {unknown[]} values\r\n */\r\nfunction _text(strs, ...values) {\r\n\tlet _strs = Array.isArray(strs)\r\n\t\t? strs.reduce((acc, curr, i) => acc + String(curr ?? '') + String(values[i] ?? ''), \"\")\r\n\t\t: strs\r\n\r\n\treturn createTextNode(_strs)\r\n}\r\n\r\n/**\r\n * @param {Array<JqElement | JqFragment | JqText>} _childNodes \r\n * @returns {JqFragment}\r\n */\r\nfunction fragment(..._childNodes) {\r\n\tconst { childNodes } = getNodes(_childNodes)\r\n\treturn new JqFragment(childNodes)\r\n}\r\n\r\n/**\r\n * @param  {Parameters<import(\"./utility.js\").AnimateFn>} parameters \r\n * @returns {JqAnimation}\r\n */\r\nexport function animate(...parameters) {\r\n\treturn new JqAnimation(...parameters)\r\n}\r\n\r\n/**\r\n * @param  {[string | { [x: string]: import(\"./utility.js\").Primitive }, ...string[]]} args\r\n */\r\nfunction _css(...args) {\r\n\r\n\tconst [ruleName, ...ruleArgs] = args\r\n\r\n\tif (args.length == 1 && !isPrimitive(ruleName)) {\r\n\t\tconst rule = new JqCSSRule([\":JqCSSRule\", ...ruleArgs],\r\n\t\t\t/**@type {{ [x: string]: import(\"./utility.js\").Primitive }}*/(ruleName))\r\n\t\treturn rule\r\n\t}\r\n\r\n\t/**\r\n\t * @type {(...styleNodes: JqCSSRule[]) => JqCSSRule}\r\n\t */\r\n\treturn (...styleNodes) => {\r\n\t\tconst rule = new JqCSSRule([/** @type {string} */ (ruleName), ...ruleArgs], ...styleNodes)\r\n\t\treturn rule\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {{ [x: string | symbol | number]: unknown }} initialState\r\n * @returns {JqState}\r\n */\r\nexport function state(initialState = {}) {\r\n\tif (isPrimitive(initialState))\r\n\t\tthrow new TypeError(\"JqError - Expected an object as a value to state(...)\")\r\n\r\n\tconst isArray = Array.isArray(initialState)\r\n\tconst stateObj = new JqState(initialState)\r\n\r\n\tconst stateProxy = new Proxy(stateObj, {\r\n\t\tget(target, prop) {\r\n\t\t\tif (prop == JqNodeReference)\r\n\t\t\t\treturn target\r\n\r\n\t\t\tif (prop == StateReference)\r\n\t\t\t\treturn target[StateReference]\r\n\r\n\t\t\treturn target[StateReference][prop]\r\n\t\t},\r\n\t\tset(target, prop, value) {\r\n\t\t\ttarget[StateReference][prop] = value\r\n\t\t\tif (isArray && prop == \"length\") return true\r\n\r\n\t\t\tfor (const watcher of target.watchers) {\r\n\t\t\t\twatcher.reconcile()\r\n\t\t\t}\r\n\t\t\treturn true\r\n\t\t},\r\n\t\thas(target, prop) {\r\n\t\t\treturn Reflect.has(target[StateReference], prop)\r\n\t\t},\r\n\t})\r\n\r\n\treturn stateProxy\r\n}\r\n\r\n/**\r\n * @param {JqState[]} _states\r\n * @returns {JqWatch}\r\n */\r\nexport function watch(..._states) {\r\n\tthrow new JqWatch(..._states)\r\n}\r\n\r\n/**\r\n * @param {boolean} condition\r\n */\r\nexport function when(condition) {\r\n\tthrow new JqCondition(condition)\r\n}\r\n\r\n/**\r\n * @param {string} eventName\r\n * @returns {JqEvent}\r\n */\r\nfunction _on(eventName) {\r\n\tthrow new JqEvent(eventName)\r\n}\r\n\r\n/**\r\n * @template T\r\n * @param {{[Symbol.iterator]: () => IterableIterator<T>, [x: string | symbol | number]: any}} iterable \r\n */\r\nexport function each(iterable) {\r\n\tthrow new JqEach(iterable)\r\n}\r\n\r\n/**\r\n * @returns {JqElement | JqFragment}\r\n */\r\nexport function attach() {\r\n\tthrow new JqLifecycle(OnAttachCallback)\r\n}\r\n\r\n/**\r\n * @returns {JqElement | JqFragment}\r\n */\r\nexport function detach() {\r\n\tthrow new JqLifecycle(OnDetachCallback)\r\n}\r\n\r\n/**\r\n * @template T\r\n * @param {() => Promise<T>} promisedCallback \r\n */\r\nexport function wait(promisedCallback) {\r\n\treturn new JqPromise(promisedCallback)\r\n}\r\n\r\nexport const nodes = { attr, text, fragment }\r\nexport { paths, getNodes } from \"./utility.js\"\r\n\r\n/**\r\n * @typedef {{ [name: string]: (...nodes: Array<import(\"./utility.js\").JqNode>) => JqElement }} NativeConstructor\r\n * \r\n * @typedef {{ globalize: (_globalThis?: {}) => void }} Globalizer\r\n * \r\n * @typedef {NativeConstructor & Globalizer} Natives\r\n * \r\n * @typedef {(name: string, parent?: typeof HTMLElement) => (...nodes: import(\"./utility.js\").JqNode[]) => JqElement} CustomConstructor\r\n * \r\n * @typedef {{[CustomElements]: string[]}} Customizer\r\n * \r\n * @typedef {CustomConstructor & Customizer} Customs\r\n * \r\n * @typedef {(attrObj: { [x: string]: import(\"./utility.js\").Primitive }) => JqList<JqAttribute, typeof JqAttribute>} AttrFn\r\n * \r\n * @typedef {{ [x: string]: JqAttribute }} AttrProps\r\n * \r\n * @typedef {(styleObj: { [x: string]: import(\"./utility.js\").Primitive }) => JqCSSRule} CSSFn\r\n * \r\n * @typedef {{ [x: string]: JqCSSProperty }} CSSProps\r\n * \r\n * @typedef {(eventName: string) => JqEvent} OnFn\r\n * \r\n * @typedef {{ [eventName: string | symbol]: (handler: (event?: Event, ...a: unknown[]) => unknown) => JqEvent }} OnProps\r\n */"],"names":["CREATED","Symbol","UPDATED","DELETED","UNCHANGED","OnAttachCallback","OnDetachCallback","StateReference","PromisePending","PromiseResolved","PromiseRejected","paths","Object","create","isPrimitive","test","isJqElement","xs","every","x","JqElement","isJqAttribute","JqAttribute","isJqFragment","JqFragment","isJqText","JqText","isNullish","values","getJqNodeConstructors","JqCSSProperty","JqCSSRule","JqAnimation","JqEvent","JqWatch","JqEach","JqCondition","JqLifecycle","JqList","JqPromise","throwError","e","errorClass","Error","JqNodeReference","getNodes","nodes","childNodes","attributes","events","animations","watchers","conditions","iterators","lifecycles","promiseStates","inlineStyles","blockStyles","i","node","classifyNode","nodePosition","push","nodeClass","attribute","JqPromiseState","Array","isArray","_node","convertToJqNode","getCallbackArg","callback","isJqEffectNode","TypeError","value","jqParent","jqNodes","length","jqFragment","promisesStates","convertToJqFragment","jqText","convertToJqText","jqEffectNode","convertToJqEffectNode","some","X","getPropertyValue","object","props","result","state","jqPromise","constructor","this","subscriptions","pending","resolved","rejected","promise","invoke","forEach","sub","then","catch","subscribe","subscription","subscriber","type","delete","context","deleteSelf","jqLifecycle","delNodeIdx","findIndex","lifecycle","is","splice","iterable","_","returned","results","item","jqEach","JqEffectNode","static","invalidParent","condition","jqCondition","event","attachHandler","element","addEventListener","detachHandler","removeEventListener","attachTo","HTMLElement","errors","invalidAttachTo","includes","jqEvent","domNode","jqStates","map","jqState","reconcile","oldNode","newNode","extractEffectReturn","_diff","diff","jqWatcher","_jqState","removeWatcher","node1","node2","updatedChanges","createdChanges","deletedChanges","firstProp","nestedProps","updateText","updateAttribute","updateElement","createFragment","createElement","deleteFragmentChild","deleteElementChild","childDiffs","_node1","_node2","update","setAttribute","setText","text","replaceChild","_childNode","childNode","JqState","watcher","_watcher","domAnimation","parameters","animate","_styles","_options","_moreOptions","options","speed","easing","_callback","option","duration","fill","__styles","Map","fromEntries","styles","setInitialStyles","keys","filter","styleName","finalStyleValue","getComputedStyle","name","camelToKebab","replace","String","style","setProperty","toString","indent","jqCSSProperty","nameNode","valueNode","head","body","ruleName","ruleArgs","styleNodes","errorMessage","invalidHeadArgument","flatMap","styleNode","styleObject","styleProperties","entries","key","createPropertyListFromStyleObject","styleEl","document","textContent","appendChild","space","repeat","join","trim","jqCSSRule","headFragment","styleFragments","JqStyleNode","getStyleClass","getStyleFragment","pop","iterator","_name","_value","attrNode","attrName","attrValue","initial","createNode","setAttributeNode","jqAttribute","createAttribute","jqElement","removeAttribute","attrObj","attrList","primitives","primitive","alterDomNode","shadowRoot","createTextNode","nodeValue","delChildIdx","remove","scopedStyleSheet","JqParentable","attachNode","createDocumentFragment","attachChildren","oldChildNode","newChildNode","childNodeNotFound","parentNode","jqEffectNodes","id","Math","random","slice","createHash","assign","hasElmStartIndent","emptyTagSelfClosure","childMarkup","selfAttrs","selfCallbacks","selfMarkupHead","selfMarkupTail","attachAttributes","attachEventListeners","attachAnimations","IntersectionObserver","observer","entry","observerCallback","isIntersecting","animation","disconnect","observe","attachStyles","indexOfAttr","indexOf","unstylableElement","formatSelectorAndGetStyleFragment","resolvePseudoClsAndGetStyleFragment","maybeAttachStyleElementToHTMLParent","attachStylesToStylesheet","isNonStylable","classList","add","blockStyle","from","jqNode","ancestor","getEffectNodes","childCount","precedingEffectNodes","getPrecedingEffectNodes","attachEffectNodes","collectDetachableEffectNodes","getParentableClass","getInstancesFromParent","getEffectClass","similarEffectInstances","instance","effectNode","isInvokableEffectNode","effectNodes","watcherIdx","precedingJqEffectNodes","effectNodePos","maxLength","max","_jqEffectNodes","Boolean","jqStyleElement","hash","formatSelector","selector","hashCls","startsWith","str","$","ofs","toLowerCase","nodeComparison","firstElemChildren","secondElemChildren","firstElemAttributes","secondElemAttributes","getPrototypeOf","firstElemChild","secondElemChild","undefined","firstElemAttribute","secondElemAttribute","compareJqElements","firstFragChildren","secondFragChildren","firstFragChild","secondFragChild","compareJqFragments","jqAttribute1","jqAttribute2","compareProps","compareJqAttributes","affected1","affected2","compareJqTexts","isNode1","isNode2","compareJqGenericNodes","compareJqNodes","deletedProps","prop","createdProps","updatedProps","unchangedProps","validHTMLElements","CustomElements","natives","Proxy","get","target","globalize","_globalThis","globalThis","strs","reduce","acc","curr","attr","objectToJqAttributes","on","eventName","handler","css","args","_custom","parent","customElements","_JqElement","super","custom","define","initialState","stateObj","set","has","Reflect","watch","_states","when","each","attach","detach","wait","promisedCallback","fragment","_childNodes"],"mappings":"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"}